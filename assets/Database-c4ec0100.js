import{j as e,m as f,e as y,R as l,h as A,p as Y,q as b,W as U,L as z,D as P}from"./main-0727ade0.js";import{H as V}from"./HerbList-d8823bef.js";import{m as _,u as J}from"./useFilteredHerbs-480791a1.js";import{S as W}from"./StarfieldBackground-56a7b774.js";import{u as Z}from"./useHerbs-52d77077.js";const E={type:"spring",stiffness:220,damping:20},Q={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};function G({allTags:o,activeTags:r,onToggleTag:d}){const h=t=>{d(t)},i=()=>{r.forEach(t=>d(t))},u={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{staggerChildren:.05}}},m=Q;return e.jsxs(f.div,{variants:u,initial:"hidden",animate:"visible",className:"no-scrollbar flex items-center gap-2 overflow-x-auto py-2",children:[e.jsx("span",{className:"pl-1 pr-2 text-xs font-semibold text-opal",children:r.length>0?`Filtered (${r.length})`:"Filter Tags"}),o.map(t=>{const c=r.includes(t);return e.jsx(f.button,{variants:m,type:"button","aria-pressed":c,"aria-label":`${c?"Remove":"Add"} filter ${y(t)}`,onClick:()=>h(t),whileTap:{scale:.9},whileHover:{scale:1.08},animate:c?{scale:[1,1.15,1],boxShadow:"0 0 8px rgba(16,185,129,0.8)"}:{scale:1,boxShadow:"none"},transition:{...E,repeat:c?1/0:0,repeatType:"mirror",duration:1.2},className:`tag-pill hover-glow whitespace-nowrap transition-colors duration-300 ${c?"bg-emerald-700/70 text-white ring-2 ring-emerald-400 dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:y(t)},t)}),r.length>0&&e.jsx(f.button,{type:"button","aria-label":"Clear all filters",onClick:i,whileTap:{scale:.9},whileHover:{scale:1.08},transition:E,className:"tag-pill hover-glow whitespace-nowrap bg-rose-700/70 text-white transition-colors duration-300 dark:bg-rose-800",children:"Clear Filters"})]})}const C=5;function K(){const o=l.useMemo(()=>{const t={};return A.forEach(c=>{const x=c.category.split("/")[0].trim();t[x]=(t[x]||0)+1}),t},[]),r=l.useMemo(()=>Object.entries(o).sort((t,c)=>c[1]-t[1]),[o]),[d,h]=l.useState(!1),i=l.useMemo(()=>d?r:r.filter(([,t])=>t>=C),[r,d]),u=l.useMemo(()=>r.some(([,t])=>t<C),[r]),m=Math.max(...r.map(([,t])=>t));return e.jsxs("div",{className:"relative space-y-2",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[i.map(([t,c])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:t}),e.jsx("div",{className:"flex-1 h-2 rounded bg-gray-200 dark:bg-gray-700 transition-colors duration-300",children:e.jsx("div",{className:"h-2 rounded bg-pink-500 dark:bg-pink-400 transition-colors duration-300",style:{width:`${c/m*100}%`}})}),e.jsx("span",{className:"text-sm",children:c})]},t)),u&&!d&&e.jsx("div",{className:"pointer-events-none text-center text-xs text-moss",children:"Hover to show more"})]})}function X({selected:o,onChange:r}){const d=l.useMemo(()=>{const i={};return A.forEach(u=>{const m=_(u.category);i[m]=(i[m]||0)+1}),i},[]),h=i=>{const u=o.includes(i)?o.filter(m=>m!==i):[...o,i];r==null||r(u)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d).sort((i,u)=>u[1]-i[1]).map(([i,u])=>e.jsxs("button",{type:"button",onClick:()=>h(i),className:`tag-pill transition-colors duration-300 ${o.includes(i)?"ring-2 ring-emerald-400 bg-emerald-700/70 text-white dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:[i," (",u,")"]},i))})}function q({query:o,setQuery:r,fuse:d}){const[h,i]=l.useState([]);l.useEffect(()=>{const t=o.trim();i(t?d.search(t,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[])},[o,d]);const u=t=>{if(!o)return t;const c=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),x=new RegExp(`(${c})`,"ig");return t.replace(x,'<span class="font-bold">$1</span>')},m=t=>{const c=[t.item.name,...t.item.altNames||[]].join(", ");return u(c)};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...","aria-label":"Search herbs",tabIndex:0,value:o,onChange:t=>r(t.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),h.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:h.map(t=>e.jsx("li",{children:e.jsx("button",{type:"button",tabIndex:0,"aria-label":`Select ${t.item.name}`,className:"w-full text-left rounded px-2 py-1 hover:bg-white/10",onClick:()=>r(t.item.name),dangerouslySetInnerHTML:{__html:m(t)}})},t.item.id))})]})}function ee(o,r){try{const d=localStorage.getItem(o);return d?JSON.parse(d):r}catch{return r}}function L(o,r){try{localStorage.setItem(o,JSON.stringify(r))}catch{}}function oe(){const o=Z(),r=l.useMemo(()=>{const s=a=>a&&typeof a.name=="string"&&typeof a.slug=="string"&&Array.isArray(a.tags)&&Array.isArray(a.effects),n=o.filter(a=>!s(a));return n.length&&console.error("Filtered invalid herb entries:",n),o.filter(s)},[o]),{favorites:d}=Y(),{filtered:h,query:i,setQuery:u,tags:m,setTags:t,matchAll:c,setMatchAll:x,categories:M,setCategories:F,favoritesOnly:T,setFavoritesOnly:H,sort:O,setSort:$,fuse:I}=J(r,{favorites:d});l.useEffect(()=>{var a;const n=((a=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:a.split(","))||[];n.length&&setTimeout(()=>{n.forEach(p=>{const g=document.getElementById(`herb-${p}`);g&&(g.scrollIntoView({behavior:"smooth"}),g.classList.add("ring-2","ring-sky-300"),setTimeout(()=>g.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),l.useEffect(()=>{const s=ee("dbScroll",0);s&&window.scrollTo(0,s);const n=()=>L("dbScroll",window.scrollY);return window.addEventListener("scroll",n),()=>{L("dbScroll",window.scrollY),window.removeEventListener("scroll",n)}},[]);const B=l.useMemo(()=>{const s=r.reduce((n,a)=>n.concat(a.tags),[]);return Array.from(new Set(s.map(b)))},[r]),w=l.useMemo(()=>{const s=r.filter(a=>a.affiliateLink&&a.affiliateLink.startsWith("http")).length,n=r.filter(a=>a.mechanismOfAction&&a.mechanismOfAction.trim()).length;return{total:r.length,affiliates:s,moaCount:n}},[r]),D=l.useCallback(s=>t(n=>n.includes(s)?n.filter(a=>a!==s):[...n,s]),[t]),v=o.length-r.length,[j,k]=l.useState(!1),[N,R]=l.useState(!0);l.useEffect(()=>{const s={current:window.scrollY},n=()=>{const a=window.scrollY;R(a<s.current||a<100),s.current=a};return window.addEventListener("scroll",n,{passive:!0}),()=>window.removeEventListener("scroll",n)},[]),l.useEffect(()=>{const s=()=>{window.scrollY>150&&k(!1)};return window.addEventListener("scroll",s,{passive:!0}),window.addEventListener("touchmove",s,{passive:!0}),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]);const S=l.useMemo(()=>{if(m.length===0)return[];const s={};return o.forEach(n=>{m.every(a=>n.tags.some(p=>b(p)===b(a)))&&n.tags.forEach(a=>{const p=b(a);m.some(g=>b(g)===p)||(s[p]=(s[p]||0)+1)})}),Object.entries(s).sort((n,a)=>a[1]-n[1]).slice(0,5).map(([n])=>n)},[m,o]);return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(W,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(f.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:N?0:-60,opacity:N?1:0},transition:{duration:.3},children:[e.jsx(q,{query:i,setQuery:u,fuse:I}),e.jsx("button",{type:"button",onClick:()=>H(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:T?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>x(s=>!s),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:c?"Match ALL":"Match ANY"}),e.jsxs("select",{value:O,onChange:s=>$(s.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[e.jsx("option",{value:"",children:"Sort By..."}),e.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),e.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),e.jsx(z,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:e.jsx(P,{size:18})}),e.jsx("button",{type:"button",onClick:()=>k(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:j?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${j?"":"hidden sm:block"}`,children:[e.jsx(X,{selected:M,onChange:F}),e.jsx(G,{allTags:B,activeTags:m,onToggleTag:D})]}),S.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),S.map(s=>e.jsx("button",{type:"button",onClick:()=>t(n=>Array.from(new Set([...n,s]))),className:"tag-pill",children:y(s)},s))]}),e.jsx(K,{}),v>0&&e.jsxs("p",{className:"mb-2 rounded-md border border-red-500/40 bg-red-500/10 p-2 text-center text-sm text-red-300",children:[v," entries contained errors and were hidden. Please report this issue."]}),(()=>{try{return e.jsx(V,{herbs:h,highlightQuery:i})}catch(s){return console.error("Failed to render herb list",s),e.jsx("p",{className:"text-center text-red-500",children:"Error loading herb entries."})}})(),e.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",w.total," · Affiliate links: ",w.affiliates," · MOA documented:"," ",w.moaCount," · Updated: ",new Date("2025-07-24T23:07:32.051Z").toLocaleDateString()]})]})]})]})}export{oe as default};
