import{r as j,j as e,m as v,n as T,R as u,W as C}from"./main-4b9367fc.js";import{l as O,f as M,u as R,H as F}from"./index-08fbd06b.js";import{u as H,T as L,c as $,h as E}from"./herbs-bdace311.js";import{a as P,d as w,n as S,t as A}from"./format-d7efe303.js";import{F as z}from"./fuse-11af6271.js";import"./star-808e8535.js";const B=["Effect","Preparation","Safety","Chemistry","Region","Other"];function D({tags:a,onChange:n,storageKey:l="tagFilters",counts:o={}}){const[c,m]=H(l,[]),[i,h]=j.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),[x,p]=j.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});j.useEffect(()=>{n==null||n(c)},[c,n]);const b=j.useMemo(()=>{const t={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return a.forEach(s=>{const f=P(s);t[f].push(s)}),t},[a]),g=t=>{m(s=>s.includes(t)?s.filter(f=>f!==t):[...s,t])},y=t=>{switch(t){case"Effect":return"⚡ Effects";case"Preparation":return"🌿 Preparation";case"Safety":return"⚠️ Safety";case"Chemistry":return"🧪 Chemistry";case"Region":return"📍 Region";default:return"✨ Other"}},r=t=>{const s=b[t]||[],f=12,k=x[t]?s:s.slice(0,f);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[k.map(d=>e.jsx(v.button,{type:"button",onClick:()=>g(d),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:c.includes(d)?1:.6},"aria-pressed":c.includes(d),className:"flex-shrink-0 focus:outline-none",title:o[d]?`${w(S(d))} — used in ${o[d]} herbs`:w(S(d)),children:e.jsx(L,{label:w(S(d)),variant:c.includes(d)?"green":A(d),className:$(c.includes(d)&&"ring-1 ring-emerald-400")})},d)),s.length>f&&e.jsx(v.button,{type:"button",whileHover:{scale:1.05},onClick:()=>p(d=>({...d,[t]:!d[t]})),className:"tag-pill mt-2",children:x[t]?"Show Less":"Show More"})]})})};return e.jsx("div",{className:"space-y-3",children:B.map(t=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>h(s=>({...s,[t]:!s[t]})),"aria-expanded":i[t],children:[y(t),e.jsx(v.span,{animate:{rotate:i[t]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx(T,{initial:!1,children:i[t]&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:r(t)},"content")})]},t))})}function I(){const a=u.useMemo(()=>{const l={};return E.forEach(o=>{const c=o.category.split("/")[0].trim();l[c]=(l[c]||0)+1}),l},[]),n=Math.max(...Object.values(a));return e.jsx("div",{className:"space-y-2",children:Object.entries(a).map(([l,o])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:l}),e.jsx("div",{className:"flex-1 bg-slate-700/50 h-2 rounded",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${o/n*100}%`}})}),e.jsx("span",{className:"text-sm",children:o})]},l))})}function Y(){const a=j.useCallback(async n=>{await O(n)},[]);return e.jsx(M,{id:"starfield",init:a,options:{fullScreen:{enable:!0,zIndex:-10},background:{color:"transparent"},particles:{number:{value:100,density:{enable:!0,area:800}},color:{value:["#ffffff","#ffaadf","#c1ffdd"]},size:{value:{min:.5,max:1.5}},move:{enable:!0,speed:.15},opacity:{value:{min:.1,max:.6}}}}})}function _(){const[a]=u.useState(E);return a}function J({query:a,setQuery:n,fuse:l}){const[o,c]=u.useState([]);u.useEffect(()=>{const i=a.trim();c(i?l.search(i,{limit:5}):[])},[a,l]);const m=i=>{if(!a)return i;const h=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),x=new RegExp(`(${h})`,"ig");return i.replace(x,'<span class="font-bold">$1</span>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:a,onChange:i=>n(i.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),o.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:o.map(i=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full text-left hover:bg-white/10 px-2 py-1 rounded",onClick:()=>n(i.item.name),dangerouslySetInnerHTML:{__html:m(i.item.name)}})},i.item.id))})]})}function Q(a,n={}){const{favorites:l=[]}=n,[o,c]=u.useState(""),[m,i]=u.useState([]),[h,x]=u.useState(!1),[p,b]=u.useState(""),g=u.useMemo(()=>new z(a,{keys:["name","scientificName","effects","description","tags"],threshold:.4,includeMatches:!0}),[a]);return{filtered:u.useMemo(()=>{let r=a;const t=o.trim();return t&&(r=g.search(t).map(s=>s.item)),m.length&&(r=r.filter(s=>m.every(f=>s.tags.includes(f)))),h&&(r=r.filter(s=>l.includes(s.id))),p==="name"&&(r=[...r].sort((s,f)=>s.name.localeCompare(f.name))),r},[a,o,m,h,l,p,g]),query:o,setQuery:c,tags:m,setTags:i,favoritesOnly:h,setFavoritesOnly:x,sort:p,setSort:b,fuse:g}}function G(a,n){try{const l=localStorage.getItem(a);return l?JSON.parse(l):n}catch{return n}}function N(a,n){try{localStorage.setItem(a,JSON.stringify(n))}catch{}}function Z(){const a=_(),{favorites:n}=R(),{filtered:l,query:o,setQuery:c,tags:m,setTags:i,favoritesOnly:h,setFavoritesOnly:x,fuse:p}=Q(a,{favorites:n});u.useEffect(()=>{const r=G("dbScroll",0);r&&window.scrollTo(0,r);const t=()=>N("dbScroll",window.scrollY);return window.addEventListener("scroll",t),()=>{N("dbScroll",window.scrollY),window.removeEventListener("scroll",t)}},[]);const b=u.useMemo(()=>{const r=a.reduce((t,s)=>t.concat(s.tags),[]);return Array.from(new Set(r))},[a]),g=u.useMemo(()=>{const r={};return a.forEach(t=>{t.tags.forEach(s=>{r[s]=(r[s]||0)+1})}),r},[a]),y=u.useMemo(()=>{if(m.length===0)return[];const r={};return a.forEach(t=>{m.every(s=>t.tags.includes(s))&&t.tags.forEach(s=>{m.includes(s)||(r[s]=(r[s]||0)+1)})}),Object.entries(r).sort((t,s)=>s[1]-t[1]).slice(0,5).map(([t])=>t)},[m,a]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(Y,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-gray-300",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs("div",{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",children:[e.jsx(J,{query:o,setQuery:c,fuse:p}),e.jsx("button",{type:"button",onClick:()=>x(r=>!r),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:h?"All Herbs":"My Herbs"})]}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{tags:b,counts:g,onChange:i})}),y.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),y.map(r=>e.jsx("button",{type:"button",onClick:()=>i(t=>Array.from(new Set([...t,r]))),className:"tag-pill",children:w(r)},r))]}),e.jsx(I,{}),e.jsx(F,{herbs:l,highlightQuery:o})]})]})]})}export{Z as default};
