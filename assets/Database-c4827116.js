import{r as L,j as e,m as k,n as P,R as i,o as I,W as $}from"./main-0a80006b.js";import{u as Y,H as z}from"./HerbList-aab921f3.js";import{c as C,T as _,a as J}from"./TagBadge-8cdd78d0.js";import{n as M,a as Q,d as F,t as U}from"./format-5969a492.js";import{u as G}from"./useLocalStorage-b85b51a4.js";import{h as D}from"./herbs-1a1e5de8.js";import{F as V}from"./fuse-11af6271.js";import{S as W}from"./StarfieldBackground-5ffca4aa.js";import{u as q}from"./useHerbs-e4cb3e0b.js";import"./star-dd770746.js";const K=["Effect","Preparation","Safety","Chemistry","Region","Other"];function X({tags:t,onChange:n,storageKey:l="tagFilters",counts:f={},mode:o="AND",onModeChange:r}){const[u,y]=G(l,[]),[h,b]=L.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),j=()=>y([]),[w,T]=L.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});L.useEffect(()=>{n==null||n(u)},[u,n]);const S=L.useMemo(()=>{const c={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(a=>{const x=C(M(a)),p=Q(x);c[p].includes(x)||c[p].push(x)}),c},[t]),v=c=>{const a=C(c);y(x=>x.includes(a)?x.filter(p=>p!==a):[...x,a])},N=c=>{switch(c){case"Effect":return"âš¡ Effects";case"Preparation":return"ðŸŒ¿ Preparation";case"Safety":return"âš ï¸ Safety";case"Chemistry":return"ðŸ§ª Chemistry";case"Region":return"ðŸ“ Region";default:return"âœ¨ Other"}},E=c=>{const a=S[c]||[],x=12,p=w[c]?a:a.slice(0,x);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[p.map(m=>e.jsx(k.button,{type:"button",onClick:()=>v(m),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:u.includes(m)?1:.6},"aria-pressed":u.includes(m),className:"flex-shrink-0 focus:outline-none",title:f[m]?`${F(M(m))} â€” used in ${f[m]} herbs`:F(M(m)),children:e.jsx(_,{label:F(M(m)),variant:u.includes(m)?"green":U(m),className:J(u.includes(m)&&"ring-1 ring-emerald-400")})},m)),a.length>x&&e.jsx(k.button,{type:"button",whileHover:{scale:1.05},onClick:()=>T(m=>({...m,[c]:!m[c]})),className:"tag-pill mt-2",children:w[c]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>r==null?void 0:r(o==="AND"?"OR":"AND"),className:"tag-pill",children:o==="AND"?"Match ALL":"Match ANY"}),u.length>0&&e.jsx("button",{type:"button",onClick:j,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),K.map(c=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>b(a=>({...a,[c]:!a[c]})),"aria-expanded":h[c],children:[N(c),e.jsx(k.span,{animate:{rotate:h[c]?90:0},className:"ml-1 text-xs",children:"â–¶"})]}),e.jsx(P,{initial:!1,children:h[c]&&e.jsx(k.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:E(c)},"content")})]},c))]})}function Z(){const t=i.useMemo(()=>{const l={};return D.forEach(f=>{const o=f.category.split("/")[0].trim();l[o]=(l[o]||0)+1}),l},[]),n=Math.max(...Object.values(t));return e.jsx("div",{className:"space-y-2",children:Object.entries(t).map(([l,f])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:l}),e.jsx("div",{className:"flex-1 bg-slate-700/50 h-2 rounded",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${f/n*100}%`}})}),e.jsx("span",{className:"text-sm",children:f})]},l))})}function ee(t){const n=t.match(/\(([^)]+)\)/);return n?n[1].split(/[,/]| or /).map(l=>l.trim()).filter(Boolean):[]}const A={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function B(t){const n=t.toLowerCase();return/(empathogen|euphoriant)/.test(n)?"Empathogen":/(psychedelic|visionary)/.test(n)?"Psychedelic":/dissociative|sedative/.test(n)?"Dissociative":/oneirogen|dream/.test(n)?"Oneirogen":"Other"}function te(t,n={}){const{favorites:l=[]}=n,[f,o]=i.useState(""),[r,u]=i.useState([]),[y,h]=i.useState("AND"),[b,j]=i.useState(!1),[w,T]=i.useState([]),[S,v]=i.useState(""),N=i.useMemo(()=>t.map(a=>({...a,aliases:[...ee(a.name),...A[a.id]||A[a.name.toLowerCase()]||[]]})),[t]),E=i.useMemo(()=>new V(N,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[N]);return{filtered:i.useMemo(()=>{let a=t;const x=f.trim();return x&&(a=E.search(x).map(p=>p.item)),r.length&&(a=a.filter(p=>{const m=r.map(O=>p.tags.some(s=>C(s)===C(O)));return y==="AND"?m.every(Boolean):m.some(Boolean)})),w.length&&(a=a.filter(p=>w.includes(B(p.category)))),b&&(a=a.filter(p=>l.includes(p.id))),S==="name"&&(a=[...a].sort((p,m)=>p.name.localeCompare(m.name))),a},[t,f,r,w,b,l,S,E]),query:f,setQuery:o,tags:r,setTags:u,tagMode:y,setTagMode:h,categories:w,setCategories:T,favoritesOnly:b,setFavoritesOnly:j,sort:S,setSort:v,fuse:E}}function se({selected:t,onChange:n}){const l=i.useMemo(()=>{const o={};return D.forEach(r=>{const u=B(r.category);o[u]=(o[u]||0)+1}),o},[]),f=o=>{const r=t.includes(o)?t.filter(u=>u!==o):[...t,o];n==null||n(r)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(l).sort((o,r)=>r[1]-o[1]).map(([o,r])=>e.jsxs("button",{type:"button",onClick:()=>f(o),className:`tag-pill ${t.includes(o)?"ring-2 ring-emerald-400":""}`,children:[o," (",r,")"]},o))})}function ae({query:t,setQuery:n,fuse:l}){const[f,o]=i.useState([]),[r,u]=i.useState(!1);i.useEffect(()=>{u(!0);const h=t.trim(),b=setTimeout(()=>{o(h?l.search(h,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),u(!1)},200);return()=>clearTimeout(b)},[t,l]);const y=h=>{if(!t)return h;const b=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),j=new RegExp(`(${b})`,"ig");return h.replace(j,'<span class="font-bold">$1</span>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:h=>n(h.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),r&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!r&&f.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:f.map(h=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>n(h.item.name),dangerouslySetInnerHTML:{__html:y(h.item.name)}})},h.item.id))})]})}function ne(t,n){try{const l=localStorage.getItem(t);return l?JSON.parse(l):n}catch{return n}}function H(t,n){try{localStorage.setItem(t,JSON.stringify(n))}catch{}}function pe(){const t=q(),{favorites:n}=Y(),{filtered:l,query:f,setQuery:o,tags:r,setTags:u,categories:y,setCategories:h,tagMode:b,setTagMode:j,favoritesOnly:w,setFavoritesOnly:T,fuse:S}=te(t,{favorites:n}),[v,N]=I();i.useEffect(()=>{const s=ne("dbScroll",0);s&&window.scrollTo(0,s);const d=()=>H("dbScroll",window.scrollY);return window.addEventListener("scroll",d),()=>{H("dbScroll",window.scrollY),window.removeEventListener("scroll",d)}},[]),i.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const d=document.getElementById(s);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const E=i.useMemo(()=>{const s=t.reduce((d,g)=>d.concat(g.tags),[]);return Array.from(new Set(s.map(C)))},[t]),c=i.useMemo(()=>{const s={};return t.forEach(d=>{d.tags.forEach(g=>{const R=C(g);s[R]=(s[R]||0)+1})}),s},[t]),[a,x]=i.useState(!1),[p,m]=i.useState(!0);i.useEffect(()=>{const s=v.get("tags");if(s){const d=s.split(",").map(g=>decodeURIComponent(g));u(d)}},[]),i.useEffect(()=>{r.length>0?v.set("tags",r.map(encodeURIComponent).join(",")):v.delete("tags"),N(v,{replace:!0})},[r,v,N]),i.useEffect(()=>{let s=window.scrollY;const d=()=>{const g=window.scrollY;m(g<s||g<100),s=g};return window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]),i.useEffect(()=>{const s=()=>{window.scrollY>150&&x(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),i.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[r,y,f]);const O=i.useMemo(()=>{if(r.length===0)return[];const s={};return t.forEach(d=>{r.every(g=>d.tags.includes(g))&&d.tags.forEach(g=>{r.includes(g)||(s[g]=(s[g]||0)+1)})}),Object.entries(s).sort((d,g)=>g[1]-d[1]).slice(0,5).map(([d])=>d)},[r,t]);return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(W,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(k.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:p?0:-60,opacity:p?1:0},transition:{duration:.3},children:[e.jsx(ae,{query:f,setQuery:o,fuse:S}),e.jsx("button",{type:"button",onClick:()=>T(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:w?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>x(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:a?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${a?"":"hidden sm:block"}`,children:[e.jsx(se,{selected:y,onChange:h}),e.jsx(X,{tags:E,counts:c,onChange:u,mode:b,onModeChange:j})]}),O.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),O.map(s=>e.jsx("button",{type:"button",onClick:()=>u(d=>Array.from(new Set([...d,s]))),className:"tag-pill",children:F(s)},s))]}),e.jsx(Z,{}),e.jsx(z,{herbs:l,highlightQuery:f})]})]})]})}export{pe as default};
