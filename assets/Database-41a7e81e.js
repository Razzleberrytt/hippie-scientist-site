import{r as L,j as e,m as C,n as P,R as i,o as I,W as $}from"./main-ca9bec1f.js";import{u as Y,H as z}from"./HerbList-af41dfbe.js";import{c as k,T as _,a as J}from"./TagBadge-ef210f55.js";import{n as F,a as Q,d as M,t as U}from"./format-5969a492.js";import{u as G}from"./useLocalStorage-07095062.js";import{h as B}from"./compoundData-ce3d2f18.js";import{F as V}from"./fuse-11af6271.js";import{S as W}from"./StarfieldBackground-6d6df9c5.js";import{u as q}from"./useHerbs-d597f731.js";import"./star-088809bd.js";const K=["Effect","Preparation","Safety","Chemistry","Region","Other"];function X({tags:t,onChange:r,storageKey:c="tagFilters",counts:f={},mode:o="AND",onModeChange:n}){const[u,y]=G(c,[]),[p,b]=L.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),j=()=>y([]),[w,T]=L.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});L.useEffect(()=>{r==null||r(u)},[u,r]);const S=L.useMemo(()=>{const l={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(a=>{const g=k(F(a)),h=Q(g);l[h].includes(g)||l[h].push(g)}),l},[t]),v=l=>{const a=k(l);y(g=>g.includes(a)?g.filter(h=>h!==a):[...g,a])},N=l=>{switch(l){case"Effect":return"âš¡ Effects";case"Preparation":return"ðŸŒ¿ Preparation";case"Safety":return"âš ï¸ Safety";case"Chemistry":return"ðŸ§ª Chemistry";case"Region":return"ðŸ“ Region";default:return"âœ¨ Other"}},E=l=>{const a=S[l]||[],g=12,h=w[l]?a:a.slice(0,g);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[h.map(m=>e.jsx(C.button,{type:"button",onClick:()=>v(m),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:u.includes(m)?1:.6},"aria-pressed":u.includes(m),className:"flex-shrink-0 focus:outline-none",title:f[m]?`${M(F(m))} â€” used in ${f[m]} herbs`:M(F(m)),children:e.jsx(_,{label:M(F(m)),variant:u.includes(m)?"green":U(m),className:J(u.includes(m)&&"ring-1 ring-emerald-400")})},m)),a.length>g&&e.jsx(C.button,{type:"button",whileHover:{scale:1.05},onClick:()=>T(m=>({...m,[l]:!m[l]})),className:"tag-pill mt-2",children:w[l]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n==null?void 0:n(o==="AND"?"OR":"AND"),className:"tag-pill",children:o==="AND"?"Match ALL":"Match ANY"}),u.length>0&&e.jsx("button",{type:"button",onClick:j,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),K.map(l=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>b(a=>({...a,[l]:!a[l]})),"aria-expanded":p[l],children:[N(l),e.jsx(C.span,{animate:{rotate:p[l]?90:0},className:"ml-1 text-xs",children:"â–¶"})]}),e.jsx(P,{initial:!1,children:p[l]&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:E(l)},"content")})]},l))]})}function Z(){const t=i.useMemo(()=>{const c={};return B.forEach(f=>{const o=f.category.split("/")[0].trim();c[o]=(c[o]||0)+1}),c},[]),r=Math.max(...Object.values(t));return e.jsx("div",{className:"space-y-2",children:Object.entries(t).map(([c,f])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:c}),e.jsx("div",{className:"flex-1 bg-slate-700/50 h-2 rounded",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${f/r*100}%`}})}),e.jsx("span",{className:"text-sm",children:f})]},c))})}function ee(t){const r=t.match(/\(([^)]+)\)/);return r?r[1].split(/[,/]| or /).map(c=>c.trim()).filter(Boolean):[]}const R={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function D(t){const r=t.toLowerCase();return/(empathogen|euphoriant)/.test(r)?"Empathogen":/(psychedelic|visionary)/.test(r)?"Psychedelic":/dissociative|sedative/.test(r)?"Dissociative":/oneirogen|dream/.test(r)?"Oneirogen":"Other"}function te(t,r={}){const{favorites:c=[]}=r,[f,o]=i.useState(""),[n,u]=i.useState([]),[y,p]=i.useState("AND"),[b,j]=i.useState(!1),[w,T]=i.useState([]),[S,v]=i.useState(""),N=i.useMemo(()=>t.map(a=>({...a,aliases:[...ee(a.name),...R[a.id]||R[a.name.toLowerCase()]||[]],tagAliases:a.tags.map(g=>aliasFor(k(g))).filter(Boolean)})),[t]),E=i.useMemo(()=>new V(N,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[N]);return{filtered:i.useMemo(()=>{let a=t;const g=f.trim();return g&&(a=E.search(g).map(h=>h.item)),n.length&&(a=a.filter(h=>{const m=n.map(O=>h.tags.some(s=>k(s)===k(O)));return y==="AND"?m.every(Boolean):m.some(Boolean)})),w.length&&(a=a.filter(h=>w.includes(D(h.category)))),b&&(a=a.filter(h=>c.includes(h.id))),S==="name"&&(a=[...a].sort((h,m)=>h.name.localeCompare(m.name))),a},[t,f,n,w,b,c,S,E]),query:f,setQuery:o,tags:n,setTags:u,tagMode:y,setTagMode:p,categories:w,setCategories:T,favoritesOnly:b,setFavoritesOnly:j,sort:S,setSort:v,fuse:E}}function se({selected:t,onChange:r}){const c=i.useMemo(()=>{const o={};return B.forEach(n=>{const u=D(n.category);o[u]=(o[u]||0)+1}),o},[]),f=o=>{const n=t.includes(o)?t.filter(u=>u!==o):[...t,o];r==null||r(n)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(c).sort((o,n)=>n[1]-o[1]).map(([o,n])=>e.jsxs("button",{type:"button",onClick:()=>f(o),className:`tag-pill ${t.includes(o)?"ring-2 ring-emerald-400":""}`,children:[o," (",n,")"]},o))})}function ae({query:t,setQuery:r,fuse:c}){const[f,o]=i.useState([]),[n,u]=i.useState(!1);i.useEffect(()=>{u(!0);const p=t.trim(),b=setTimeout(()=>{o(p?c.search(p,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),u(!1)},200);return()=>clearTimeout(b)},[t,c]);const y=p=>{if(!t)return p;const b=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),j=new RegExp(`(${b})`,"ig");return p.replace(j,'<span class="font-bold">$1</span>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:p=>r(p.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),n&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!n&&f.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:f.map(p=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>r(p.item.name),dangerouslySetInnerHTML:{__html:y(p.item.name)}})},p.item.id))})]})}function re(t,r){try{const c=localStorage.getItem(t);return c?JSON.parse(c):r}catch{return r}}function H(t,r){try{localStorage.setItem(t,JSON.stringify(r))}catch{}}function he(){const t=q(),{favorites:r}=Y(),{filtered:c,query:f,setQuery:o,tags:n,setTags:u,categories:y,setCategories:p,tagMode:b,setTagMode:j,favoritesOnly:w,setFavoritesOnly:T,fuse:S}=te(t,{favorites:r}),[v,N]=I();i.useEffect(()=>{const s=re("dbScroll",0);s&&window.scrollTo(0,s);const d=()=>H("dbScroll",window.scrollY);return window.addEventListener("scroll",d),()=>{H("dbScroll",window.scrollY),window.removeEventListener("scroll",d)}},[]),i.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const d=document.getElementById(s);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const E=i.useMemo(()=>{const s=t.reduce((d,x)=>d.concat(x.tags),[]);return Array.from(new Set(s.map(k)))},[t]),l=i.useMemo(()=>{const s={};return t.forEach(d=>{d.tags.forEach(x=>{const A=k(x);s[A]=(s[A]||0)+1})}),s},[t]),[a,g]=i.useState(!1),[h,m]=i.useState(!0);i.useEffect(()=>{const s=v.get("tags");if(s){const d=s.split(",").map(x=>decodeURIComponent(x));u(d)}},[]),i.useEffect(()=>{n.length>0?v.set("tags",n.map(encodeURIComponent).join(",")):v.delete("tags"),N(v,{replace:!0})},[n,v,N]),i.useEffect(()=>{let s=window.scrollY;const d=()=>{const x=window.scrollY;m(x<s||x<100),s=x};return window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]),i.useEffect(()=>{const s=()=>{window.scrollY>150&&g(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),i.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[n,y,f]);const O=i.useMemo(()=>{if(n.length===0)return[];const s={};return t.forEach(d=>{n.every(x=>d.tags.includes(x))&&d.tags.forEach(x=>{n.includes(x)||(s[x]=(s[x]||0)+1)})}),Object.entries(s).sort((d,x)=>x[1]-d[1]).slice(0,5).map(([d])=>d)},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(W,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(C.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:h?0:-60,opacity:h?1:0},transition:{duration:.3},children:[e.jsx(ae,{query:f,setQuery:o,fuse:S}),e.jsx("button",{type:"button",onClick:()=>T(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:w?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>g(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:a?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${a?"":"hidden sm:block"}`,children:[e.jsx(se,{selected:y,onChange:p}),e.jsx(X,{tags:E,counts:l,onChange:u,mode:b,onModeChange:j})]}),O.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),O.map(s=>e.jsx("button",{type:"button",onClick:()=>u(d=>Array.from(new Set([...d,s]))),className:"tag-pill",children:M(s)},s))]}),e.jsx(Z,{}),e.jsx(z,{herbs:c,highlightQuery:f})]})]})]})}export{he as default};
