import{l as O,r as j,j as e,m as E,n as B,R as d,o as Y,W as z}from"./main-0f0fb674.js";import{u as G,H as Z}from"./HerbList-ad834972.js";import{c as L,T as _,a as J,I as Q}from"./TagBadge-ba7f264f.js";import{n as M,a as U,d as A,t as q}from"./format-5969a492.js";import{u as D}from"./useLocalStorage-025e5ba9.js";import{L as V,F as W}from"./leaf-91315b17.js";import{G as K}from"./globe-6fd48bf8.js";import{h as P}from"./compoundData-ce3d2f18.js";import{F as X}from"./fuse-11af6271.js";import{S as ee}from"./StarfieldBackground-feca0e25.js";import{u as te}from"./useHerbs-4703d23d.js";import"./star-5ac1c63e.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=O("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=O("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),oe={Effect:{label:"Effects",icon:ne},Preparation:{label:"Preparation",icon:V},Safety:{label:"Safety",icon:se},Chemistry:{label:"Chemistry",icon:W},Region:{label:"Region",icon:K},Other:{label:"Other",icon:ae}},ie=["Effect","Preparation","Safety","Chemistry","Region","Other"];function re({tags:t,onChange:o,storageKey:h="tagFilters",counts:x={},mode:y="AND",onModeChange:c}){const[u,i]=D(h,[]),[r,n]=j.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),w=()=>i([]),[v,T]=j.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});j.useEffect(()=>{o==null||o(u)},[u,o]);const S=j.useMemo(()=>{const l={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(a=>{const p=L(M(a)),g=U(p);l[g].includes(p)||l[g].push(p)}),l},[t]),N=l=>{const a=L(l);i(p=>p.includes(a)?p.filter(g=>g!==a):[...p,a])},k=l=>{const a=oe[l],p=a.icon;return e.jsxs(e.Fragment,{children:[p&&e.jsx(p,{className:"mr-1 inline-block h-4 w-4"}),a.label]})},C=l=>{const a=S[l]||[],p=12,g=v[l]?a:a.slice(0,p);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[g.map(f=>e.jsx(E.button,{type:"button",onClick:()=>N(f),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:u.includes(f)?1:.6},"aria-pressed":u.includes(f),className:"flex-shrink-0 focus:outline-none",title:x[f]?`${A(M(f))} — used in ${x[f]} herbs`:A(M(f)),children:e.jsx(_,{label:A(M(f)),variant:u.includes(f)?"green":q(f),className:J(u.includes(f)&&"ring-1 ring-emerald-400")})},f)),a.length>p&&e.jsx(E.button,{type:"button",whileHover:{scale:1.05},onClick:()=>T(f=>({...f,[l]:!f[l]})),className:"tag-pill mt-2",children:v[l]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c==null?void 0:c(y==="AND"?"OR":"AND"),className:"tag-pill",children:y==="AND"?"Match ALL":"Match ANY"}),u.length>0&&e.jsx("button",{type:"button",onClick:w,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),ie.map(l=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>n(a=>({...a,[l]:!a[l]})),"aria-expanded":r[l],children:[k(l),e.jsx(E.span,{animate:{rotate:r[l]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx(B,{initial:!1,children:r[l]&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:C(l)},"content")})]},l))]})}function le(){const t=j.useMemo(()=>{const n={};return P.forEach(w=>{const v=w.category.split("/")[0].trim();n[v]=(n[v]||0)+1}),n},[]),o=j.useMemo(()=>Object.entries(t).sort((n,w)=>w[1]-n[1]),[t]),[h,x]=j.useState(!1),[y,c]=j.useState(""),u=j.useMemo(()=>o.filter(([n])=>n.toLowerCase().includes(y.toLowerCase())),[o,y]),i=h?u:u.slice(0,12),r=Math.max(...o.map(([,n])=>n));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Find category",value:y,onChange:n=>c(n.target.value),className:"w-36 flex-1 rounded-md bg-space-dark/50 px-2 py-1 text-sm backdrop-blur-md"}),e.jsx("button",{type:"button",onClick:()=>x(n=>!n),className:"tag-pill",children:h?"Collapse":"Show All"})]}),e.jsx("div",{className:"space-y-2",children:i.map(([n,w])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{text:`${w} herbs`,children:e.jsx("span",{className:"w-40 truncate text-sm",children:n})}),e.jsx("div",{className:"h-2 flex-1 rounded bg-slate-700/50",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${w/r*100}%`}})})]},n))})]})}function ce(t){const o=t.match(/\(([^)]+)\)/);return o?o[1].split(/[,/]| or /).map(h=>h.trim()).filter(Boolean):[]}const H={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function $(t){const o=t.toLowerCase();return/(empathogen|euphoriant)/.test(o)?"Empathogen":/(psychedelic|visionary)/.test(o)?"Psychedelic":/dissociative|sedative/.test(o)?"Dissociative":/oneirogen|dream/.test(o)?"Oneirogen":"Other"}function de(t,o={}){const{favorites:h=[]}=o,[x,y]=d.useState(""),[c,u]=d.useState([]),[i,r]=d.useState("AND"),[n,w]=d.useState(!1),[v,T]=D("dbCategories",[]),[S,N]=d.useState(""),k=d.useMemo(()=>t.map(a=>({...a,aliases:[...ce(a.name),...H[a.id]||H[a.name.toLowerCase()]||[]],tagAliases:a.tags.map(p=>aliasFor(L(p))).filter(Boolean)})),[t]),C=d.useMemo(()=>new X(k,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[k]);return{filtered:d.useMemo(()=>{let a=t;const p=x.trim();return p&&(a=C.search(p).map(g=>g.item)),c.length&&(a=a.filter(g=>{const f=c.map(F=>g.tags.some(s=>L(s)===L(F)));return i==="AND"?f.every(Boolean):f.some(Boolean)})),v.length&&(a=a.filter(g=>v.includes($(g.category)))),n&&(a=a.filter(g=>h.includes(g.id))),S==="name"&&(a=[...a].sort((g,f)=>g.name.localeCompare(f.name))),a},[t,x,c,v,n,h,S,C]),query:x,setQuery:y,tags:c,setTags:u,tagMode:i,setTagMode:r,categories:v,setCategories:T,favoritesOnly:n,setFavoritesOnly:w,sort:S,setSort:N,fuse:C}}function me({selected:t,onChange:o}){const[h,x]=j.useState(!1),y=d.useMemo(()=>{const i={};return P.forEach(r=>{const n=$(r.category);i[n]=(i[n]||0)+1}),i},[]),c=i=>{const r=t.includes(i)?t.filter(n=>n!==i):[...t,i];o==null||o(r)},u=e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(y).sort((i,r)=>r[1]-i[1]).map(([i,r])=>e.jsxs("button",{type:"button",onClick:()=>c(i),className:`tag-pill max-w-[7rem] truncate ${t.includes(i)?"ring-2 ring-emerald-400":""}`,children:[i," (",r,")"]},i))});return e.jsxs("div",{children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>x(i=>!i),className:"tag-pill mb-2",children:h?"Hide Categories":"Show Categories"}),e.jsx(B,{initial:!1,children:h&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:u},"cats")})]}),e.jsx("div",{className:"hidden sm:block",children:u})]})}function ue({query:t,setQuery:o,fuse:h}){const[x,y]=d.useState([]),[c,u]=d.useState(!1);d.useEffect(()=>{u(!0);const r=t.trim(),n=setTimeout(()=>{y(r?h.search(r,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),u(!1)},200);return()=>clearTimeout(n)},[t,h]);const i=r=>{if(!t)return r;const n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),w=new RegExp(`(${n})`,"ig");return r.replace(w,'<span class="font-bold">$1</span>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:r=>o(r.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),c&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!c&&x.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:x.map(r=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>o(r.item.name),dangerouslySetInnerHTML:{__html:i(r.item.name)}})},r.item.id))})]})}function fe(t,o){try{const h=localStorage.getItem(t);return h?JSON.parse(h):o}catch{return o}}function I(t,o){try{localStorage.setItem(t,JSON.stringify(o))}catch{}}function Ce(){const t=te(),{favorites:o}=G(),{filtered:h,query:x,setQuery:y,tags:c,setTags:u,categories:i,setCategories:r,tagMode:n,setTagMode:w,favoritesOnly:v,setFavoritesOnly:T,fuse:S}=de(t,{favorites:o}),[N,k]=Y();d.useEffect(()=>{const s=fe("dbScroll",0);s&&window.scrollTo(0,s);const m=()=>I("dbScroll",window.scrollY);return window.addEventListener("scroll",m),()=>{I("dbScroll",window.scrollY),window.removeEventListener("scroll",m)}},[]),d.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const m=document.getElementById(s);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const C=d.useMemo(()=>{const s=t.reduce((m,b)=>m.concat(b.tags),[]);return Array.from(new Set(s.map(L)))},[t]),l=d.useMemo(()=>{const s={};return t.forEach(m=>{m.tags.forEach(b=>{const R=L(b);s[R]=(s[R]||0)+1})}),s},[t]),[a,p]=d.useState(!1),[g,f]=d.useState(!0);d.useEffect(()=>{const s=N.get("tags");if(s){const m=s.split(",").map(b=>decodeURIComponent(b));u(m)}},[]),d.useEffect(()=>{c.length>0?N.set("tags",c.map(encodeURIComponent).join(",")):N.delete("tags"),k(N,{replace:!0})},[c,N,k]),d.useEffect(()=>{let s=window.scrollY;const m=()=>{const b=window.scrollY;f(b<s||b<100),s=b};return window.addEventListener("scroll",m),()=>window.removeEventListener("scroll",m)},[]),d.useEffect(()=>{const s=()=>{window.scrollY>150&&p(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),d.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[c,i,x]);const F=d.useMemo(()=>{if(c.length===0)return[];const s={};return t.forEach(m=>{c.every(b=>m.tags.includes(b))&&m.tags.forEach(b=>{c.includes(b)||(s[b]=(s[b]||0)+1)})}),Object.entries(s).sort((m,b)=>b[1]-m[1]).slice(0,5).map(([m])=>m)},[c,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(ee,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(E.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:g?0:-60,opacity:g?1:0},transition:{duration:.3},children:[e.jsx(ue,{query:x,setQuery:y,fuse:S}),e.jsx("button",{type:"button",onClick:()=>T(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:v?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>p(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:a?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${a?"":"hidden sm:block"}`,children:[e.jsx(me,{selected:i,onChange:r}),e.jsx(re,{tags:C,counts:l,onChange:u,mode:n,onModeChange:w})]}),F.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),F.map(s=>e.jsx("button",{type:"button",onClick:()=>u(m=>Array.from(new Set([...m,s]))),className:"tag-pill",children:A(s)},s))]}),e.jsx(le,{}),e.jsx(Z,{herbs:h,highlightQuery:x})]})]})]})}export{Ce as default};
