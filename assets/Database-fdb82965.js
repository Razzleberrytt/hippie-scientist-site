import{l as O,r as S,j as e,m as C,A as $,R as d,o as G,W as D}from"./main-ba9ec8b0.js";import{u as U,H as Z}from"./HerbList-55705bce.js";import{c as E,T as _,a as J,I as Q,b as q}from"./TagBadge-dc3d1ed7.js";import{n as A,a as V,d as M,t as W}from"./format-5969a492.js";import{u as Y}from"./useLocalStorage-a17a6d33.js";import{L as K,F as X}from"./leaf-e5f7cf24.js";import{G as ee}from"./globe-70b0e0df.js";import{u as H}from"./compoundData-48774a6f.js";import{F as te}from"./fuse-11af6271.js";import{S as I}from"./StarfieldBackground-b8706cdc.js";import"./star-4705722f.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=O("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=O("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ie={Effect:{label:"Effects",icon:ne},Preparation:{label:"Preparation",icon:K},Safety:{label:"Safety",icon:se},Chemistry:{label:"Chemistry",icon:X},Region:{label:"Region",icon:ee},Other:{label:"Other",icon:ae}},oe=["Effect","Preparation","Safety","Chemistry","Region","Other"];function re({tags:t,onChange:i,storageKey:m="tagFilters",counts:f={},mode:b="AND",onModeChange:u}){const[h,y]=Y(m,[]),[s,p]=S.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),o=()=>y([]),[v,j]=S.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});S.useEffect(()=>{i==null||i(h)},[h,i]);const F=S.useMemo(()=>{const r={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(x=>{const n=E(A(x)),w=V(n);r[w].includes(n)||r[w].push(n)}),r},[t]),N=r=>{const x=E(r);y(n=>n.includes(x)?n.filter(w=>w!==x):[...n,x])},L=r=>{const x=ie[r],n=x.icon;return e.jsxs(e.Fragment,{children:[n&&e.jsx(n,{className:"mr-1 inline-block h-4 w-4"}),x.label]})},T=r=>{const x=F[r]||[],n=12,w=v[r]?x:x.slice(0,n);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[w.map(l=>e.jsx(C.button,{type:"button",onClick:()=>N(l),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:h.includes(l)?1:.6},"aria-pressed":h.includes(l),className:"flex-shrink-0 focus:outline-none",title:f[l]?`${M(A(l))} — used in ${f[l]} herbs`:M(A(l)),children:e.jsx(_,{label:M(A(l)),variant:h.includes(l)?"green":W(l),className:J(h.includes(l)&&"ring-1 ring-emerald-400")})},l)),x.length>n&&e.jsx(C.button,{type:"button",whileHover:{scale:1.05},onClick:()=>j(l=>({...l,[r]:!l[r]})),className:"tag-pill mt-2",children:v[r]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u==null?void 0:u(b==="AND"?"OR":"AND"),className:"tag-pill",children:b==="AND"?"Match ALL":"Match ANY"}),h.length>0&&e.jsx("button",{type:"button",onClick:o,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),oe.map(r=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>p(x=>({...x,[r]:!x[r]})),"aria-expanded":s[r],children:[L(r),e.jsx(C.span,{animate:{rotate:s[r]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx($,{initial:!1,children:s[r]&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:T(r)},"content")})]},r))]})}function le(){const t=H(),i=S.useMemo(()=>{const o={};return t==null||t.forEach(v=>{const j=v.category.split("/")[0].trim();o[j]=(o[j]||0)+1}),o},[t]),m=S.useMemo(()=>Object.entries(i).sort((o,v)=>v[1]-o[1]),[i]),[f,b]=S.useState(!1),[u,h]=S.useState(""),y=S.useMemo(()=>m.filter(([o])=>o.toLowerCase().includes(u.toLowerCase())),[m,u]),s=f?y:y.slice(0,12),p=Math.max(...m.map(([,o])=>o));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Find category",value:u,onChange:o=>h(o.target.value),className:"w-36 flex-1 rounded-md bg-space-dark/50 px-2 py-1 text-sm backdrop-blur-md"}),e.jsx("button",{type:"button",onClick:()=>b(o=>!o),className:"tag-pill",children:f?"Collapse":"Show All"})]}),e.jsx("div",{className:"space-y-2",children:s.map(([o,v])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{text:`${v} herbs`,children:e.jsx("span",{className:"w-40 truncate text-sm",children:o})}),e.jsx("div",{className:"h-2 flex-1 rounded bg-slate-700/50",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${v/p*100}%`}})})]},o))})]})}function ce(t){const i=t.match(/\(([^)]+)\)/);return i?i[1].split(/[,/]| or /).map(m=>m.trim()).filter(Boolean):[]}const B={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function z(t){const i=t.toLowerCase();return/(empathogen|euphoriant)/.test(i)?"Empathogen":/(psychedelic|visionary)/.test(i)?"Psychedelic":/dissociative|sedative/.test(i)?"Dissociative":/oneirogen|dream/.test(i)?"Oneirogen":"Other"}function de(t,i={}){const{favorites:m=[]}=i,f=t??[],[b,u]=d.useState(""),[h,y]=d.useState([]),[s,p]=d.useState("AND"),[o,v]=d.useState(!1),[j,F]=Y("dbCategories",[]),[N,L]=d.useState(""),T=d.useMemo(()=>f.map(n=>({...n,aliases:[...ce(n.name),...B[n.id]||B[n.name.toLowerCase()]||[]],tagAliases:n.tags.map(w=>q(E(w))).filter(Boolean)})),[f]),r=d.useMemo(()=>new te(T,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[T]);return{filtered:d.useMemo(()=>{let n=f;const w=b.trim();return w&&(n=r.search(w).map(l=>l.item)),h.length&&(n=n.filter(l=>{const k=h.map(a=>l.tags.some(c=>E(c)===E(a)));return s==="AND"?k.every(Boolean):k.some(Boolean)})),j.length&&(n=n.filter(l=>j.includes(z(l.category)))),o&&(n=n.filter(l=>m.includes(l.id))),N==="name"&&(n=[...n].sort((l,k)=>l.name.localeCompare(k.name))),n},[f,b,h,j,o,m,N,r]),query:b,setQuery:u,tags:h,setTags:y,tagMode:s,setTagMode:p,categories:j,setCategories:F,favoritesOnly:o,setFavoritesOnly:v,sort:N,setSort:L,fuse:r}}function me({selected:t,onChange:i}){const m=H(),[f,b]=S.useState(!1),u=d.useMemo(()=>{const s={};return m==null||m.forEach(p=>{const o=z(p.category);s[o]=(s[o]||0)+1}),s},[m]),h=s=>{const p=t.includes(s)?t.filter(o=>o!==s):[...t,s];i==null||i(p)},y=e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(u).sort((s,p)=>p[1]-s[1]).map(([s,p])=>e.jsxs("button",{type:"button",onClick:()=>h(s),className:`tag-pill max-w-[7rem] truncate ${t.includes(s)?"ring-2 ring-emerald-400":""}`,children:[s," (",p,")"]},s))});return e.jsxs("div",{children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>b(s=>!s),className:"tag-pill mb-2",children:f?"Hide Categories":"Show Categories"}),e.jsx($,{initial:!1,children:f&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:y},"cats")})]}),e.jsx("div",{className:"hidden sm:block",children:y})]})}function ue({query:t,setQuery:i,fuse:m}){const[f,b]=d.useState([]),[u,h]=d.useState(!1);d.useEffect(()=>{h(!0);const s=t.trim(),p=setTimeout(()=>{b(s?m.search(s,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),h(!1)},200);return()=>clearTimeout(p)},[t,m]);const y=s=>{if(!t)return s;const p=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${p})`,"ig");return s.replace(o,'<mark class="rounded bg-yellow-500/40 px-1">$1</mark>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:s=>i(s.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),u&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!u&&f.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:f.map(s=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>i(s.item.name),dangerouslySetInnerHTML:{__html:y(s.item.name)}})},s.item.id))})]})}function he(t,i){try{const m=localStorage.getItem(t);return m?JSON.parse(m):i}catch{return i}}function P(t,i){try{localStorage.setItem(t,JSON.stringify(i))}catch{}}function ke(){const t=H();console.log("herbs length",t?t.length:"loading");const{favorites:i}=U(),{filtered:m,query:f,setQuery:b,tags:u,setTags:h,categories:y,setCategories:s,tagMode:p,setTagMode:o,favoritesOnly:v,setFavoritesOnly:j,fuse:F}=de(t,{favorites:i}),[N,L]=G();if(!t||t.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx("title",{children:"Database - The Hippie Scientist"})}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(I,{}),e.jsx("div",{className:"text-center text-sand",children:"Unable to load herb data."})]})]});d.useEffect(()=>{const a=he("dbScroll",0);a&&window.scrollTo(0,a);const c=()=>P("dbScroll",window.scrollY);return window.addEventListener("scroll",c),()=>{P("dbScroll",window.scrollY),window.removeEventListener("scroll",c)}},[]),d.useEffect(()=>{const a=localStorage.getItem("focusHerb");if(a){const c=document.getElementById(a);c&&c.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const T=d.useMemo(()=>{if(!t)return[];const a=t.reduce((c,g)=>c.concat(g.tags),[]);return Array.from(new Set(a.map(E)))},[t]),r=d.useMemo(()=>{const a={};return t==null||t.forEach(c=>{c.tags.forEach(g=>{const R=E(g);a[R]=(a[R]||0)+1})}),a},[t]),[x,n]=d.useState(!1),[w,l]=d.useState(!0);d.useEffect(()=>{const a=N.get("tags");if(a){const c=a.split(",").map(g=>decodeURIComponent(g));h(c)}},[]),d.useEffect(()=>{u.length>0?N.set("tags",u.map(encodeURIComponent).join(",")):N.delete("tags"),L(N,{replace:!0})},[u,N,L]),d.useEffect(()=>{let a=window.scrollY;const c=()=>{const g=window.scrollY;l(g<a||g<100),a=g};return window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]),d.useEffect(()=>{const a=()=>{window.scrollY>150&&n(!1)};return window.addEventListener("scroll",a),window.addEventListener("touchmove",a),()=>{window.removeEventListener("scroll",a),window.removeEventListener("touchmove",a)}},[]),d.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[u,y,f]);const k=d.useMemo(()=>{if(u.length===0)return[];const a={};return t==null||t.forEach(c=>{u.every(g=>c.tags.includes(g))&&c.tags.forEach(g=>{u.includes(g)||(a[g]=(a[g]||0)+1)})}),Object.entries(a).sort((c,g)=>g[1]-c[1]).slice(0,5).map(([c])=>c)},[u,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(I,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(C.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:w?0:-60,opacity:w?1:0},transition:{duration:.3},children:[e.jsx(ue,{query:f,setQuery:b,fuse:F}),e.jsx("button",{type:"button",onClick:()=>j(a=>!a),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:v?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>n(a=>!a),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:x?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${x?"":"hidden sm:block"}`,children:[e.jsx(me,{selected:y,onChange:s}),e.jsx(re,{tags:T,counts:r,onChange:h,mode:p,onModeChange:o})]}),k.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),k.map(a=>e.jsx("button",{type:"button",onClick:()=>h(c=>Array.from(new Set([...c,a]))),className:"tag-pill",children:M(a)},a))]}),e.jsx(le,{}),e.jsx(Z,{herbs:m,highlightQuery:f})]})]})]})}export{ke as default};
