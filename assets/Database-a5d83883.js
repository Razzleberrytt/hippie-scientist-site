import{q as M,R as o,v as c,j as t,W as O,m as g,L as D,D as Y,g as R}from"./main-55b48d5d.js";import{H as I}from"./HerbList-eb5d4952.js";import{g as q,s as b,S as z,C as P,T as Q,a as U}from"./localStorage-e7ccca18.js";import{S as W}from"./StarfieldBackground-3d996a7f.js";import{u as Z}from"./useHerbs-4c5369cf.js";import{u as $}from"./useFilteredHerbs-781e41f9.js";function ee(){const r=Z(),{favorites:w}=M(),{filtered:v,query:h,setQuery:y,tags:l,setTags:d,matchAll:j,setMatchAll:k,categories:L,setCategories:E,favoritesOnly:S,setFavoritesOnly:T,sort:C,setSort:N,fuse:A}=$(r,{favorites:w});o.useEffect(()=>{var a;const s=((a=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:a.split(","))||[];s.length&&setTimeout(()=>{s.forEach(n=>{const i=document.getElementById(`herb-${n}`);i&&(i.scrollIntoView({behavior:"smooth"}),i.classList.add("ring-2","ring-sky-300"),setTimeout(()=>i.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),o.useEffect(()=>{const e=q("dbScroll",0);e&&window.scrollTo(0,e);const s=()=>b("dbScroll",window.scrollY);return window.addEventListener("scroll",s),()=>{b("dbScroll",window.scrollY),window.removeEventListener("scroll",s)}},[]);const F=o.useMemo(()=>{const e=r.reduce((s,a)=>s.concat(a.tags),[]);return Array.from(new Set(e.map(c)))},[r]),m=o.useMemo(()=>{const e=r.filter(a=>a.affiliateLink&&a.affiliateLink.startsWith("http")).length,s=r.filter(a=>a.mechanismOfAction&&a.mechanismOfAction.trim()).length;return{total:r.length,affiliates:e,moaCount:s}},[r]),H=o.useCallback(e=>d(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),[d]),[u,x]=o.useState(!1),[p,B]=o.useState(!0);o.useEffect(()=>{let e=window.scrollY;const s=()=>{const a=window.scrollY;B(a<e||a<100),e=a};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]),o.useEffect(()=>{const e=()=>{window.scrollY>150&&x(!1)};return window.addEventListener("scroll",e),window.addEventListener("touchmove",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("touchmove",e)}},[]);const f=o.useMemo(()=>{if(l.length===0)return[];const e={};return r.forEach(s=>{l.every(a=>s.tags.some(n=>c(n)===c(a)))&&s.tags.forEach(a=>{const n=c(a);l.some(i=>c(i)===n)||(e[n]=(e[n]||0)+1)})}),Object.entries(e).sort((s,a)=>a[1]-s[1]).slice(0,5).map(([s])=>s)},[l,r]);return t.jsxs(t.Fragment,{children:[t.jsxs(O,{children:[t.jsx("title",{children:"Database - The Hippie Scientist"}),t.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),t.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[t.jsx(W,{}),t.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[t.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[t.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),t.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),t.jsxs(g.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:p?0:-60,opacity:p?1:0},transition:{duration:.3},children:[t.jsx(z,{query:h,setQuery:y,fuse:A}),t.jsx("button",{type:"button",onClick:()=>T(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:S?"All Herbs":"My Herbs"}),t.jsx("button",{type:"button",onClick:()=>k(e=>!e),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:j?"Match ALL":"Match ANY"}),t.jsxs("select",{value:C,onChange:e=>N(e.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[t.jsx("option",{value:"",children:"Sort By..."}),t.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),t.jsx("option",{value:"category",children:"Category"}),t.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),t.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),t.jsx(D,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:t.jsx(Y,{size:18})}),t.jsx("button",{type:"button",onClick:()=>x(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:u?"Hide Filters":"Show Filters"})]}),t.jsxs("div",{className:`mb-4 space-y-4 ${u?"":"hidden sm:block"}`,children:[t.jsx(P,{selected:L,onChange:E}),t.jsx(Q,{allTags:F,activeTags:l,onToggleTag:H})]}),f.length>0&&t.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),f.map(e=>t.jsx("button",{type:"button",onClick:()=>d(s=>Array.from(new Set([...s,e]))),className:"tag-pill",children:R(e)},e))]}),t.jsx(U,{}),t.jsx(I,{herbs:v,highlightQuery:h}),t.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",m.total," · Affiliate links: ",m.affiliates," · MOA documented:"," ",m.moaCount," · Updated: ",new Date("2025-07-24T03:39:26.702Z").toLocaleDateString()]})]})]})]})}export{ee as default};
