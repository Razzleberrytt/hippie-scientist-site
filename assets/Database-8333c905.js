import{j as e,m as f,e as y,R as l,h as C,p as R,q as b,W as Y,L as U,D as z}from"./main-475ae642.js";import{H as _}from"./HerbList-b0858ea9.js";import{m as J,u as P}from"./useFilteredHerbs-aa16c0d5.js";import{S as V}from"./StarfieldBackground-2b666845.js";import{u as W}from"./useHerbs-4c40ebc3.js";const S={type:"spring",stiffness:220,damping:20},Z={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};function Q({allTags:n,activeTags:a,onToggleTag:d}){const u=t=>{d(t)},o=()=>{a.forEach(t=>d(t))},h={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{staggerChildren:.05}}},m=Z;return e.jsxs(f.div,{variants:h,initial:"hidden",animate:"visible",className:"no-scrollbar flex items-center gap-2 overflow-x-auto py-2",children:[e.jsx("span",{className:"pl-1 pr-2 text-xs font-semibold text-opal",children:a.length>0?`Filtered (${a.length})`:"Filter Tags"}),n.map(t=>{const c=a.includes(t);return e.jsx(f.button,{variants:m,type:"button","aria-pressed":c,"aria-label":`${c?"Remove":"Add"} filter ${y(t)}`,onClick:()=>u(t),whileTap:{scale:.9},whileHover:{scale:1.08},animate:c?{scale:[1,1.15,1],boxShadow:"0 0 8px rgba(16,185,129,0.8)"}:{scale:1,boxShadow:"none"},transition:{...S,repeat:c?1/0:0,repeatType:"mirror",duration:1.2},className:`tag-pill hover-glow whitespace-nowrap transition-colors duration-300 ${c?"bg-emerald-700/70 text-white ring-2 ring-emerald-400 dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:y(t)},t)}),a.length>0&&e.jsx(f.button,{type:"button","aria-label":"Clear all filters",onClick:o,whileTap:{scale:.9},whileHover:{scale:1.08},transition:S,className:"tag-pill hover-glow whitespace-nowrap bg-rose-700/70 text-white transition-colors duration-300 dark:bg-rose-800",children:"Clear Filters"})]})}const E=5;function G(){const n=l.useMemo(()=>{const t={};return C.forEach(c=>{const x=c.category.split("/")[0].trim();t[x]=(t[x]||0)+1}),t},[]),a=l.useMemo(()=>Object.entries(n).sort((t,c)=>c[1]-t[1]),[n]),[d,u]=l.useState(!1),o=l.useMemo(()=>d?a:a.filter(([,t])=>t>=E),[a,d]),h=l.useMemo(()=>a.some(([,t])=>t<E),[a]),m=Math.max(...a.map(([,t])=>t));return e.jsxs("div",{className:"relative space-y-2",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[o.map(([t,c])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:t}),e.jsx("div",{className:"flex-1 h-2 rounded bg-gray-200 dark:bg-gray-700 transition-colors duration-300",children:e.jsx("div",{className:"h-2 rounded bg-pink-500 dark:bg-pink-400 transition-colors duration-300",style:{width:`${c/m*100}%`}})}),e.jsx("span",{className:"text-sm",children:c})]},t)),h&&!d&&e.jsx("div",{className:"pointer-events-none text-center text-xs text-moss",children:"Hover to show more"})]})}function K({selected:n,onChange:a}){const d=l.useMemo(()=>{const o={};return C.forEach(h=>{const m=J(h.category);o[m]=(o[m]||0)+1}),o},[]),u=o=>{const h=n.includes(o)?n.filter(m=>m!==o):[...n,o];a==null||a(h)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d).sort((o,h)=>h[1]-o[1]).map(([o,h])=>e.jsxs("button",{type:"button",onClick:()=>u(o),className:`tag-pill transition-colors duration-300 ${n.includes(o)?"ring-2 ring-emerald-400 bg-emerald-700/70 text-white dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:[o," (",h,")"]},o))})}function X({query:n,setQuery:a,fuse:d}){const[u,o]=l.useState([]);l.useEffect(()=>{const t=n.trim();o(t?d.search(t,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[])},[n,d]);const h=t=>{if(!n)return t;const c=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),x=new RegExp(`(${c})`,"ig");return t.replace(x,'<span class="font-bold">$1</span>')},m=t=>{const c=[t.item.name,...t.item.altNames||[]].join(", ");return h(c)};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...","aria-label":"Search herbs",tabIndex:0,value:n,onChange:t=>a(t.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),u.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:u.map(t=>e.jsx("li",{children:e.jsx("button",{type:"button",tabIndex:0,"aria-label":`Select ${t.item.name}`,className:"w-full text-left rounded px-2 py-1 hover:bg-white/10",onClick:()=>a(t.item.name),dangerouslySetInnerHTML:{__html:m(t)}})},t.item.id))})]})}function q(n,a){try{const d=localStorage.getItem(n);return d?JSON.parse(d):a}catch{return a}}function L(n,a){try{localStorage.setItem(n,JSON.stringify(a))}catch{}}function ne(){const n=W(),a=l.useMemo(()=>n.filter(s=>s&&typeof s.name=="string"&&typeof s.slug=="string"&&Array.isArray(s.effects)),[n]),{favorites:d}=R(),{filtered:u,query:o,setQuery:h,tags:m,setTags:t,matchAll:c,setMatchAll:x,categories:A,setCategories:M,favoritesOnly:T,setFavoritesOnly:F,sort:H,setSort:O,fuse:$}=P(a,{favorites:d});l.useEffect(()=>{var i;const r=((i=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:i.split(","))||[];r.length&&setTimeout(()=>{r.forEach(p=>{const g=document.getElementById(`herb-${p}`);g&&(g.scrollIntoView({behavior:"smooth"}),g.classList.add("ring-2","ring-sky-300"),setTimeout(()=>g.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),l.useEffect(()=>{const s=q("dbScroll",0);s&&window.scrollTo(0,s);const r=()=>L("dbScroll",window.scrollY);return window.addEventListener("scroll",r),()=>{L("dbScroll",window.scrollY),window.removeEventListener("scroll",r)}},[]);const I=l.useMemo(()=>{const s=a.reduce((r,i)=>r.concat(i.tags),[]);return Array.from(new Set(s.map(b)))},[a]),w=l.useMemo(()=>{const s=a.filter(i=>i.affiliateLink&&i.affiliateLink.startsWith("http")).length,r=a.filter(i=>i.mechanismOfAction&&i.mechanismOfAction.trim()).length;return{total:a.length,affiliates:s,moaCount:r}},[a]),B=l.useCallback(s=>t(r=>r.includes(s)?r.filter(i=>i!==s):[...r,s]),[t]),[v,j]=l.useState(!1),[k,D]=l.useState(!0);l.useEffect(()=>{let s=window.scrollY;const r=()=>{const i=window.scrollY;D(i<s||i<100),s=i};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),l.useEffect(()=>{const s=()=>{window.scrollY>150&&j(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]);const N=l.useMemo(()=>{if(m.length===0)return[];const s={};return n.forEach(r=>{m.every(i=>r.tags.some(p=>b(p)===b(i)))&&r.tags.forEach(i=>{const p=b(i);m.some(g=>b(g)===p)||(s[p]=(s[p]||0)+1)})}),Object.entries(s).sort((r,i)=>i[1]-r[1]).slice(0,5).map(([r])=>r)},[m,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(V,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(f.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:k?0:-60,opacity:k?1:0},transition:{duration:.3},children:[e.jsx(X,{query:o,setQuery:h,fuse:$}),e.jsx("button",{type:"button",onClick:()=>F(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:T?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>x(s=>!s),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:c?"Match ALL":"Match ANY"}),e.jsxs("select",{value:H,onChange:s=>O(s.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[e.jsx("option",{value:"",children:"Sort By..."}),e.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),e.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),e.jsx(U,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:e.jsx(z,{size:18})}),e.jsx("button",{type:"button",onClick:()=>j(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:v?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${v?"":"hidden sm:block"}`,children:[e.jsx(K,{selected:A,onChange:M}),e.jsx(Q,{allTags:I,activeTags:m,onToggleTag:B})]}),N.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),N.map(s=>e.jsx("button",{type:"button",onClick:()=>t(r=>Array.from(new Set([...r,s]))),className:"tag-pill",children:y(s)},s))]}),e.jsx(G,{}),(()=>{try{return e.jsx(_,{herbs:u,highlightQuery:o})}catch(s){return console.error("Failed to render herb list",s),e.jsx("p",{className:"text-center text-red-500",children:"Error loading herb entries."})}})(),e.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",w.total," · Affiliate links: ",w.affiliates," · MOA documented:"," ",w.moaCount," · Updated: ",new Date("2025-07-23T11:48:34.047Z").toLocaleDateString()]})]})]})]})}export{ne as default};
