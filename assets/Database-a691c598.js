import{l as O,r as j,j as e,m as C,A as P,R as u,o as G,W as R}from"./main-a00c7e15.js";import{u as U,H as Z}from"./HerbList-39f34ca6.js";import{c as E,T as _,a as J,I as Q}from"./TagBadge-b2a65bfc.js";import{n as A,a as q,d as M,t as V}from"./format-5969a492.js";import{u as $}from"./useLocalStorage-af83fb78.js";import{L as W,F as K}from"./leaf-d4279b28.js";import{G as X}from"./globe-dc178902.js";import{h as Y}from"./compoundData-4198ca33.js";import{F as ee}from"./fuse-11af6271.js";import{S as D}from"./StarfieldBackground-b6ac3b2d.js";import{u as te}from"./useHerbs-2a053c45.js";import"./star-ac0ac748.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=O("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=O("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ie={Effect:{label:"Effects",icon:ne},Preparation:{label:"Preparation",icon:W},Safety:{label:"Safety",icon:se},Chemistry:{label:"Chemistry",icon:K},Region:{label:"Region",icon:X},Other:{label:"Other",icon:ae}},re=["Effect","Preparation","Safety","Chemistry","Region","Other"];function oe({tags:t,onChange:n,storageKey:f="tagFilters",counts:x={},mode:g="AND",onModeChange:h}){const[d,o]=$(f,[]),[r,i]=j.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),y=()=>o([]),[N,S]=j.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});j.useEffect(()=>{n==null||n(d)},[d,n]);const F=j.useMemo(()=>{const l={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(p=>{const a=E(A(p)),w=q(a);l[w].includes(a)||l[w].push(a)}),l},[t]),v=l=>{const p=E(l);o(a=>a.includes(p)?a.filter(w=>w!==p):[...a,p])},L=l=>{const p=ie[l],a=p.icon;return e.jsxs(e.Fragment,{children:[a&&e.jsx(a,{className:"mr-1 inline-block h-4 w-4"}),p.label]})},T=l=>{const p=F[l]||[],a=12,w=N[l]?p:p.slice(0,a);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[w.map(c=>e.jsx(C.button,{type:"button",onClick:()=>v(c),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:d.includes(c)?1:.6},"aria-pressed":d.includes(c),className:"flex-shrink-0 focus:outline-none",title:x[c]?`${M(A(c))} — used in ${x[c]} herbs`:M(A(c)),children:e.jsx(_,{label:M(A(c)),variant:d.includes(c)?"green":V(c),className:J(d.includes(c)&&"ring-1 ring-emerald-400")})},c)),p.length>a&&e.jsx(C.button,{type:"button",whileHover:{scale:1.05},onClick:()=>S(c=>({...c,[l]:!c[l]})),className:"tag-pill mt-2",children:N[l]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h==null?void 0:h(g==="AND"?"OR":"AND"),className:"tag-pill",children:g==="AND"?"Match ALL":"Match ANY"}),d.length>0&&e.jsx("button",{type:"button",onClick:y,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),re.map(l=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>i(p=>({...p,[l]:!p[l]})),"aria-expanded":r[l],children:[L(l),e.jsx(C.span,{animate:{rotate:r[l]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx(P,{initial:!1,children:r[l]&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:T(l)},"content")})]},l))]})}function le(){const t=j.useMemo(()=>{const i={};return Y.forEach(y=>{const N=y.category.split("/")[0].trim();i[N]=(i[N]||0)+1}),i},[]),n=j.useMemo(()=>Object.entries(t).sort((i,y)=>y[1]-i[1]),[t]),[f,x]=j.useState(!1),[g,h]=j.useState(""),d=j.useMemo(()=>n.filter(([i])=>i.toLowerCase().includes(g.toLowerCase())),[n,g]),o=f?d:d.slice(0,12),r=Math.max(...n.map(([,i])=>i));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Find category",value:g,onChange:i=>h(i.target.value),className:"w-36 flex-1 rounded-md bg-space-dark/50 px-2 py-1 text-sm backdrop-blur-md"}),e.jsx("button",{type:"button",onClick:()=>x(i=>!i),className:"tag-pill",children:f?"Collapse":"Show All"})]}),e.jsx("div",{className:"space-y-2",children:o.map(([i,y])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{text:`${y} herbs`,children:e.jsx("span",{className:"w-40 truncate text-sm",children:i})}),e.jsx("div",{className:"h-2 flex-1 rounded bg-slate-700/50",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${y/r*100}%`}})})]},i))})]})}function ce(t){const n=t.match(/\(([^)]+)\)/);return n?n[1].split(/[,/]| or /).map(f=>f.trim()).filter(Boolean):[]}const I={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function z(t){const n=t.toLowerCase();return/(empathogen|euphoriant)/.test(n)?"Empathogen":/(psychedelic|visionary)/.test(n)?"Psychedelic":/dissociative|sedative/.test(n)?"Dissociative":/oneirogen|dream/.test(n)?"Oneirogen":"Other"}function de(t,n={}){const{favorites:f=[]}=n,x=t??[],[g,h]=u.useState(""),[d,o]=u.useState([]),[r,i]=u.useState("AND"),[y,N]=u.useState(!1),[S,F]=$("dbCategories",[]),[v,L]=u.useState(""),T=u.useMemo(()=>x.map(a=>({...a,aliases:[...ce(a.name),...I[a.id]||I[a.name.toLowerCase()]||[]],tagAliases:a.tags.map(w=>aliasFor(E(w))).filter(Boolean)})),[x]),l=u.useMemo(()=>new ee(T,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[T]);return{filtered:u.useMemo(()=>{let a=x;const w=g.trim();return w&&(a=l.search(w).map(c=>c.item)),d.length&&(a=a.filter(c=>{const k=d.map(s=>c.tags.some(m=>E(m)===E(s)));return r==="AND"?k.every(Boolean):k.some(Boolean)})),S.length&&(a=a.filter(c=>S.includes(z(c.category)))),y&&(a=a.filter(c=>f.includes(c.id))),v==="name"&&(a=[...a].sort((c,k)=>c.name.localeCompare(k.name))),a},[x,g,d,S,y,f,v,l]),query:g,setQuery:h,tags:d,setTags:o,tagMode:r,setTagMode:i,categories:S,setCategories:F,favoritesOnly:y,setFavoritesOnly:N,sort:v,setSort:L,fuse:l}}function me({selected:t,onChange:n}){const[f,x]=j.useState(!1),g=u.useMemo(()=>{const o={};return Y.forEach(r=>{const i=z(r.category);o[i]=(o[i]||0)+1}),o},[]),h=o=>{const r=t.includes(o)?t.filter(i=>i!==o):[...t,o];n==null||n(r)},d=e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(g).sort((o,r)=>r[1]-o[1]).map(([o,r])=>e.jsxs("button",{type:"button",onClick:()=>h(o),className:`tag-pill max-w-[7rem] truncate ${t.includes(o)?"ring-2 ring-emerald-400":""}`,children:[o," (",r,")"]},o))});return e.jsxs("div",{children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>x(o=>!o),className:"tag-pill mb-2",children:f?"Hide Categories":"Show Categories"}),e.jsx(P,{initial:!1,children:f&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:d},"cats")})]}),e.jsx("div",{className:"hidden sm:block",children:d})]})}function ue({query:t,setQuery:n,fuse:f}){const[x,g]=u.useState([]),[h,d]=u.useState(!1);u.useEffect(()=>{d(!0);const r=t.trim(),i=setTimeout(()=>{g(r?f.search(r,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),d(!1)},200);return()=>clearTimeout(i)},[t,f]);const o=r=>{if(!t)return r;const i=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),y=new RegExp(`(${i})`,"ig");return r.replace(y,'<mark class="rounded bg-yellow-500/40 px-1">$1</mark>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:r=>n(r.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),h&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!h&&x.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:x.map(r=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>n(r.item.name),dangerouslySetInnerHTML:{__html:o(r.item.name)}})},r.item.id))})]})}function he(t,n){try{const f=localStorage.getItem(t);return f?JSON.parse(f):n}catch{return n}}function B(t,n){try{localStorage.setItem(t,JSON.stringify(n))}catch{}}function Ce(){const t=te();console.log("herbs length",t.length);const{favorites:n}=U(),{filtered:f,query:x,setQuery:g,tags:h,setTags:d,categories:o,setCategories:r,tagMode:i,setTagMode:y,favoritesOnly:N,setFavoritesOnly:S,fuse:F}=de(t,{favorites:n}),[v,L]=G();if(t.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx("title",{children:"Database - The Hippie Scientist"})}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(D,{}),e.jsx("div",{className:"text-center text-sand",children:"Unable to load herb data."})]})]});u.useEffect(()=>{const s=he("dbScroll",0);s&&window.scrollTo(0,s);const m=()=>B("dbScroll",window.scrollY);return window.addEventListener("scroll",m),()=>{B("dbScroll",window.scrollY),window.removeEventListener("scroll",m)}},[]),u.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const m=document.getElementById(s);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const T=u.useMemo(()=>{const s=t.reduce((m,b)=>m.concat(b.tags),[]);return Array.from(new Set(s.map(E)))},[t]),l=u.useMemo(()=>{const s={};return t.forEach(m=>{m.tags.forEach(b=>{const H=E(b);s[H]=(s[H]||0)+1})}),s},[t]),[p,a]=u.useState(!1),[w,c]=u.useState(!0);u.useEffect(()=>{const s=v.get("tags");if(s){const m=s.split(",").map(b=>decodeURIComponent(b));d(m)}},[]),u.useEffect(()=>{h.length>0?v.set("tags",h.map(encodeURIComponent).join(",")):v.delete("tags"),L(v,{replace:!0})},[h,v,L]),u.useEffect(()=>{let s=window.scrollY;const m=()=>{const b=window.scrollY;c(b<s||b<100),s=b};return window.addEventListener("scroll",m),()=>window.removeEventListener("scroll",m)},[]),u.useEffect(()=>{const s=()=>{window.scrollY>150&&a(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),u.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[h,o,x]);const k=u.useMemo(()=>{if(h.length===0)return[];const s={};return t.forEach(m=>{h.every(b=>m.tags.includes(b))&&m.tags.forEach(b=>{h.includes(b)||(s[b]=(s[b]||0)+1)})}),Object.entries(s).sort((m,b)=>b[1]-m[1]).slice(0,5).map(([m])=>m)},[h,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(D,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(C.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:w?0:-60,opacity:w?1:0},transition:{duration:.3},children:[e.jsx(ue,{query:x,setQuery:g,fuse:F}),e.jsx("button",{type:"button",onClick:()=>S(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:N?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>a(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:p?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${p?"":"hidden sm:block"}`,children:[e.jsx(me,{selected:o,onChange:r}),e.jsx(oe,{tags:T,counts:l,onChange:d,mode:i,onModeChange:y})]}),k.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),k.map(s=>e.jsx("button",{type:"button",onClick:()=>d(m=>Array.from(new Set([...m,s]))),className:"tag-pill",children:M(s)},s))]}),e.jsx(le,{}),e.jsx(Z,{herbs:f,highlightQuery:x})]})]})]})}export{Ce as default};
