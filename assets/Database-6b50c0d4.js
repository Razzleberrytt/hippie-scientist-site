import{r as T,j as t,m as N,n as H,R as l,W as D}from"./main-3f403011.js";import{u as B,H as $}from"./HerbList-94fc267c.js";import{c as E,T as P,a as I}from"./TagBadge-98cf038a.js";import{n as O,a as Y,d as L,t as z}from"./format-5969a492.js";import{u as _}from"./useLocalStorage-b7dedea5.js";import{h as R}from"./herbs-1a1e5de8.js";import{F as J}from"./fuse-11af6271.js";import{S as Q}from"./StarfieldBackground-8dcb0c9b.js";import{u as G}from"./useHerbs-bc448a5b.js";import"./star-b08f20ad.js";const V=["Effect","Preparation","Safety","Chemistry","Region","Other"];function W({tags:s,onChange:a,storageKey:c="tagFilters",counts:m={},mode:n="AND",onModeChange:i}){const[u,b]=_(c,[]),[f,g]=T.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),v=()=>b([]),[y,k]=T.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});T.useEffect(()=>{a==null||a(u)},[u,a]);const j=T.useMemo(()=>{const o={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return s.forEach(r=>{const x=E(O(r)),h=Y(x);o[h].includes(x)||o[h].push(x)}),o},[s]),C=o=>{const r=E(o);b(x=>x.includes(r)?x.filter(h=>h!==r):[...x,r])},S=o=>{switch(o){case"Effect":return"âš¡ Effects";case"Preparation":return"ðŸŒ¿ Preparation";case"Safety":return"âš ï¸ Safety";case"Chemistry":return"ðŸ§ª Chemistry";case"Region":return"ðŸ“ Region";default:return"âœ¨ Other"}},w=o=>{const r=j[o]||[],x=12,h=y[o]?r:r.slice(0,x);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"tag-list",children:[h.map(e=>t.jsx(N.button,{type:"button",onClick:()=>C(e),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:u.includes(e)?1:.6},"aria-pressed":u.includes(e),className:"flex-shrink-0 focus:outline-none",title:m[e]?`${L(O(e))} â€” used in ${m[e]} herbs`:L(O(e)),children:t.jsx(P,{label:L(O(e)),variant:u.includes(e)?"green":z(e),className:I(u.includes(e)&&"ring-1 ring-emerald-400")})},e)),r.length>x&&t.jsx(N.button,{type:"button",whileHover:{scale:1.05},onClick:()=>k(e=>({...e,[o]:!e[o]})),className:"tag-pill mt-2",children:y[o]?"Show Less":"Show More"})]})})};return t.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[t.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>i==null?void 0:i(n==="AND"?"OR":"AND"),className:"tag-pill",children:n==="AND"?"Match ALL":"Match ANY"}),u.length>0&&t.jsx("button",{type:"button",onClick:v,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),V.map(o=>t.jsxs("div",{className:"tag-section",children:[t.jsxs("button",{type:"button",className:"tag-label",onClick:()=>g(r=>({...r,[o]:!r[o]})),"aria-expanded":f[o],children:[S(o),t.jsx(N.span,{animate:{rotate:f[o]?90:0},className:"ml-1 text-xs",children:"â–¶"})]}),t.jsx(H,{initial:!1,children:f[o]&&t.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:w(o)},"content")})]},o))]})}function q(){const s=l.useMemo(()=>{const c={};return R.forEach(m=>{const n=m.category.split("/")[0].trim();c[n]=(c[n]||0)+1}),c},[]),a=Math.max(...Object.values(s));return t.jsx("div",{className:"space-y-2",children:Object.entries(s).map(([c,m])=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-40 text-sm",children:c}),t.jsx("div",{className:"flex-1 bg-slate-700/50 h-2 rounded",children:t.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${m/a*100}%`}})}),t.jsx("span",{className:"text-sm",children:m})]},c))})}function K(s){const a=s.match(/\(([^)]+)\)/);return a?a[1].split(/[,/]| or /).map(c=>c.trim()).filter(Boolean):[]}function A(s){const a=s.toLowerCase();return/(empathogen|euphoriant)/.test(a)?"Empathogen":/(psychedelic|visionary)/.test(a)?"Psychedelic":/dissociative|sedative/.test(a)?"Dissociative":/oneirogen|dream/.test(a)?"Oneirogen":"Other"}function U(s,a={}){const{favorites:c=[]}=a,[m,n]=l.useState(""),[i,u]=l.useState([]),[b,f]=l.useState("AND"),[g,v]=l.useState(!1),[y,k]=l.useState([]),[j,C]=l.useState(""),S=l.useMemo(()=>s.map(r=>({...r,aliases:K(r.name)})),[s]),w=l.useMemo(()=>new J(S,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[S]);return{filtered:l.useMemo(()=>{let r=s;const x=m.trim();return x&&(r=w.search(x).map(h=>h.item)),i.length&&(r=r.filter(h=>{const e=i.map(d=>h.tags.some(p=>E(p)===E(d)));return b==="AND"?e.every(Boolean):e.some(Boolean)})),y.length&&(r=r.filter(h=>y.includes(A(h.category)))),g&&(r=r.filter(h=>c.includes(h.id))),j==="name"&&(r=[...r].sort((h,e)=>h.name.localeCompare(e.name))),r},[s,m,i,y,g,c,j,w]),query:m,setQuery:n,tags:i,setTags:u,tagMode:b,setTagMode:f,categories:y,setCategories:k,favoritesOnly:g,setFavoritesOnly:v,sort:j,setSort:C,fuse:w}}function X({selected:s,onChange:a}){const c=l.useMemo(()=>{const n={};return R.forEach(i=>{const u=A(i.category);n[u]=(n[u]||0)+1}),n},[]),m=n=>{const i=s.includes(n)?s.filter(u=>u!==n):[...s,n];a==null||a(i)};return t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(c).sort((n,i)=>i[1]-n[1]).map(([n,i])=>t.jsxs("button",{type:"button",onClick:()=>m(n),className:`tag-pill ${s.includes(n)?"ring-2 ring-emerald-400":""}`,children:[n," (",i,")"]},n))})}function Z({query:s,setQuery:a,fuse:c}){const[m,n]=l.useState([]),[i,u]=l.useState(!1);l.useEffect(()=>{u(!0);const f=s.trim(),g=setTimeout(()=>{n(f?c.search(f,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),u(!1)},200);return()=>clearTimeout(g)},[s,c]);const b=f=>{if(!s)return f;const g=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),v=new RegExp(`(${g})`,"ig");return f.replace(v,'<span class="font-bold">$1</span>')};return t.jsxs("div",{className:"relative w-full",children:[t.jsx("input",{type:"text",placeholder:"Search herbs...",value:s,onChange:f=>a(f.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),i&&t.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!i&&m.length>0&&t.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:m.map(f=>t.jsx("li",{children:t.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>a(f.item.name),dangerouslySetInnerHTML:{__html:b(f.item.name)}})},f.item.id))})]})}function ee(s,a){try{const c=localStorage.getItem(s);return c?JSON.parse(c):a}catch{return a}}function F(s,a){try{localStorage.setItem(s,JSON.stringify(a))}catch{}}function me(){const s=G(),{favorites:a}=B(),{filtered:c,query:m,setQuery:n,tags:i,setTags:u,categories:b,setCategories:f,tagMode:g,setTagMode:v,favoritesOnly:y,setFavoritesOnly:k,fuse:j}=U(s,{favorites:a});l.useEffect(()=>{const e=ee("dbScroll",0);e&&window.scrollTo(0,e);const d=()=>F("dbScroll",window.scrollY);return window.addEventListener("scroll",d),()=>{F("dbScroll",window.scrollY),window.removeEventListener("scroll",d)}},[]),l.useEffect(()=>{const e=localStorage.getItem("focusHerb");if(e){const d=document.getElementById(e);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const C=l.useMemo(()=>{const e=s.reduce((d,p)=>d.concat(p.tags),[]);return Array.from(new Set(e.map(E)))},[s]),S=l.useMemo(()=>{const e={};return s.forEach(d=>{d.tags.forEach(p=>{const M=E(p);e[M]=(e[M]||0)+1})}),e},[s]),[w,o]=l.useState(!1),[r,x]=l.useState(!0);l.useEffect(()=>{let e=window.scrollY;const d=()=>{const p=window.scrollY;x(p<e||p<100),e=p};return window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]),l.useEffect(()=>{const e=()=>{window.scrollY>150&&o(!1)};return window.addEventListener("scroll",e),window.addEventListener("touchmove",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("touchmove",e)}},[]),l.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[i,b,m]);const h=l.useMemo(()=>{if(i.length===0)return[];const e={};return s.forEach(d=>{i.every(p=>d.tags.includes(p))&&d.tags.forEach(p=>{i.includes(p)||(e[p]=(e[p]||0)+1)})}),Object.entries(e).sort((d,p)=>p[1]-d[1]).slice(0,5).map(([d])=>d)},[i,s]);return t.jsxs(t.Fragment,{children:[t.jsxs(D,{children:[t.jsx("title",{children:"Database - The Hippie Scientist"}),t.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),t.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[t.jsx(Q,{}),t.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[t.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[t.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),t.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),t.jsxs(N.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:r?0:-60,opacity:r?1:0},transition:{duration:.3},children:[t.jsx(Z,{query:m,setQuery:n,fuse:j}),t.jsx("button",{type:"button",onClick:()=>k(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:y?"All Herbs":"My Herbs"}),t.jsx("button",{type:"button",onClick:()=>o(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:w?"Hide Filters":"Show Filters"})]}),t.jsxs("div",{className:`mb-4 space-y-4 ${w?"":"hidden sm:block"}`,children:[t.jsx(X,{selected:b,onChange:f}),t.jsx(W,{tags:C,counts:S,onChange:u,mode:g,onModeChange:v})]}),h.length>0&&t.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),h.map(e=>t.jsx("button",{type:"button",onClick:()=>u(d=>Array.from(new Set([...d,e]))),className:"tag-pill",children:L(e)},e))]}),t.jsx(q,{}),t.jsx($,{herbs:c,highlightQuery:m})]})]})]})}export{me as default};
