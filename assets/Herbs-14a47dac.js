import{R as E,p as V,h as N,q as G,r as o,v as h,j as t,W as J,m as d,A as T,L as K,D as X,g as _}from"./main-55b48d5d.js";import{H as ee}from"./HerbList-eb5d4952.js";import{g as te,s as A,S as se,C as ae,T as oe,a as re}from"./localStorage-e7ccca18.js";import{S as ne}from"./StarfieldBackground-3d996a7f.js";import{C as ie,a as le}from"./CompoundTagFilter-9788a866.js";import{u as ce}from"./useHerbs-4c5369cf.js";import{u as de,m as me}from"./useFilteredHerbs-781e41f9.js";function ue(){const[r]=E.useState(V);return E.useEffect(()=>{r.forEach(l=>{(l.foundInHerbs??l.sourceHerbs).forEach(c=>{N.find(u=>u.id===c)||console.warn(`Compound ${l.name} references missing herb: ${c}`)})}),N.forEach(l=>{var m;(m=l.activeConstituents)==null||m.forEach(c=>{r.find(u=>u.name.toLowerCase()===c.name.toLowerCase())||console.warn(`Herb ${l.name} lists unknown compound: ${c.name}`)})})},[r]),r}function we(){const r=ce(),{favorites:l}=G(),{filtered:m,query:c,setQuery:u,tags:p,setTags:f,matchAll:F,setMatchAll:H,categories:M,setCategories:B,favoritesOnly:O,setFavoritesOnly:I,sort:$,setSort:Y,fuse:R}=de(r,{favorites:l}),[b,D]=o.useState("herbs"),[v,j]=o.useState(!1),[C,P]=o.useState(!0);o.useEffect(()=>{let e=window.scrollY;const s=()=>{const a=window.scrollY;P(a<e||a<100),e=a};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]),o.useEffect(()=>{const e=()=>{window.scrollY>150&&j(!1)};return window.addEventListener("scroll",e),window.addEventListener("touchmove",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("touchmove",e)}},[]),o.useEffect(()=>{var a;const s=((a=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:a.split(","))||[];s.length&&setTimeout(()=>{s.forEach(n=>{const i=document.getElementById(`herb-${n}`);i&&(i.scrollIntoView({behavior:"smooth"}),i.classList.add("ring-2","ring-sky-300"),setTimeout(()=>i.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),o.useEffect(()=>{const e=te("dbScroll",0);e&&window.scrollTo(0,e);const s=()=>A("dbScroll",window.scrollY);return window.addEventListener("scroll",s),()=>{A("dbScroll",window.scrollY),window.removeEventListener("scroll",s)}},[]);const q=o.useMemo(()=>{const e=r.reduce((s,a)=>s.concat(a.tags),[]);return Array.from(new Set(e.map(h)))},[r]),g=o.useMemo(()=>{const e=r.filter(a=>a.affiliateLink&&a.affiliateLink.startsWith("http")).length,s=r.filter(a=>a.mechanismOfAction&&a.mechanismOfAction.trim()).length;return{total:r.length,affiliates:e,moaCount:s}},[r]),z=o.useCallback(e=>f(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),[f]),k=ue(),[y,Q]=o.useState(""),[w,U]=o.useState([]),S=o.useMemo(()=>{const e=new Map;return r.forEach(s=>{e.set(s.name.toLowerCase(),{slug:s.slug,category:s.category})}),e},[r]),x=o.useMemo(()=>k.map(e=>{const s=(e.foundIn||[]).map(n=>{const i=S.get(n.toLowerCase());return{name:n,slug:i==null?void 0:i.slug,category:i==null?void 0:i.category}}),a=new Set(s.map(n=>n.category?me(n.category):void 0).filter(Boolean));return{...e,herbsFound:s,effectClass:Array.from(a).join(", ")}}),[k,S]),W=o.useMemo(()=>Array.from(new Set(x.map(e=>e.type))).sort().map(e=>({label:e,value:e})),[x]),Z=o.useMemo(()=>x.filter(e=>{const s=y.trim().toLowerCase(),a=!s||e.name.toLowerCase().includes(s)||e.herbsFound.some(i=>i.name.toLowerCase().includes(s)),n=w.length===0||w.includes(e.type);return a&&n}),[y,w,x]),L=o.useMemo(()=>{if(p.length===0)return[];const e={};return r.forEach(s=>{p.every(a=>s.tags.some(n=>h(n)===h(a)))&&s.tags.forEach(a=>{const n=h(a);p.some(i=>h(i)===n)||(e[n]=(e[n]||0)+1)})}),Object.entries(e).sort((s,a)=>a[1]-s[1]).slice(0,5).map(([s])=>s)},[p,r]);return t.jsxs(t.Fragment,{children:[t.jsxs(J,{children:[t.jsx("title",{children:"Herbs & Compounds - The Hippie Scientist"}),t.jsx("meta",{name:"description",content:"Browse psychoactive herbs and their active compounds."})]}),t.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[t.jsx(ne,{}),t.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[t.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herbal Index"}),t.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs and their active compounds."})]}),t.jsx("div",{className:"mx-auto mb-6 flex justify-center",children:t.jsx("div",{className:"relative flex space-x-2 rounded-md bg-black/20 p-1 backdrop-blur",children:["herbs","compounds"].map(e=>t.jsxs("button",{type:"button",onClick:()=>D(e),className:`relative z-10 rounded-md px-3 py-1 text-sm font-medium ${b===e?"text-white":"text-sand"}`,children:[b===e&&t.jsx(d.div,{layoutId:"tab",className:"absolute inset-0 rounded-md bg-fuchsia-700/40"}),t.jsx("span",{className:"relative",children:e==="herbs"?"Herbs":"Compounds"})]},e))})}),t.jsx(T,{mode:"wait",children:b==="herbs"?t.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[t.jsxs(d.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:C?0:-60,opacity:C?1:0},transition:{duration:.3},children:[t.jsx(se,{query:c,setQuery:u,fuse:R}),t.jsx("button",{type:"button",onClick:()=>I(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:O?"All Herbs":"My Herbs"}),t.jsx("button",{type:"button",onClick:()=>H(e=>!e),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:F?"Match ALL":"Match ANY"}),t.jsxs("select",{value:$,onChange:e=>Y(e.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[t.jsx("option",{value:"",children:"Sort By..."}),t.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),t.jsx("option",{value:"category",children:"Category"}),t.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),t.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),t.jsx(K,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:t.jsx(X,{size:18})}),t.jsx("button",{type:"button",onClick:()=>j(e=>!e),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:v?"Hide Filters":"Show Filters"})]}),t.jsxs("div",{className:`mb-4 space-y-4 ${v?"":"hidden sm:block"}`,children:[t.jsx(ae,{selected:M,onChange:B}),t.jsx(oe,{allTags:q,activeTags:p,onToggleTag:z})]}),L.length>0&&t.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),L.map(e=>t.jsx("button",{type:"button",onClick:()=>f(s=>Array.from(new Set([...s,e]))),className:"tag-pill",children:_(e)},e))]}),t.jsx(re,{}),t.jsx(ee,{herbs:m,highlightQuery:c}),t.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",g.total," · Affiliate links: ",g.affiliates," · MOA documented: ",g.moaCount," · Updated: ",new Date("2025-07-24T03:39:26.702Z").toLocaleDateString()]})]},"herbs"):t.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[t.jsxs("div",{className:"mb-4 flex flex-col items-center gap-4",children:[t.jsx("input",{type:"text",placeholder:"Search compounds or herbs...",value:y,onChange:e=>Q(e.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none sm:w-72"}),t.jsx(ie,{options:W,onChange:U})]}),t.jsx(d.div,{layout:!0,className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.jsx(T,{children:Z.map(e=>t.jsx(d.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:t.jsx(le,{compound:e})},e.name))})})]},"compounds")})]})]})]})}export{we as default};
