import{l as B,r as k,j as e,m as M,A as U,R as c,o as _,W as D}from"./main-444040a6.js";import{u as J,H as Q}from"./HerbList-a5610a71.js";import{T as q,c as V,I as W}from"./TagBadge-92806035.js";import{c as T,n as H,a as K,d as R,t as X,b as ee}from"./format-b20dbf99.js";import{u as P}from"./useLocalStorage-ceeb1c18.js";import{L as te,F as se}from"./leaf-df809539.js";import{G as ae}from"./globe-ca355c98.js";import{u as $}from"./compoundData-3619a252.js";import{F as ne}from"./fuse-11af6271.js";import{S as I}from"./StarfieldBackground-49340c68.js";import"./slugify-386a61cd.js";import"./star-ed386054.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=B("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=B("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=B("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),le={Effect:{label:"Effects",icon:re},Preparation:{label:"Preparation",icon:te},Safety:{label:"Safety",icon:ie},Chemistry:{label:"Chemistry",icon:se},Region:{label:"Region",icon:ae},Other:{label:"Other",icon:oe}},ce=["Effect","Preparation","Safety","Chemistry","Region","Other"];function de({tags:t,onChange:i,storageKey:m="tagFilters",counts:f={},mode:g="AND",onModeChange:y}){const[l,j]=P(m,[]),[a,h]=k.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),o=()=>j([]),[v,N]=k.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});k.useEffect(()=>{i==null||i(l)},[l,i]);const A=k.useMemo(()=>{const n={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(u=>{const b=T(H(u)),w=K(b);n[w].includes(b)||n[w].push(b)}),n},[t]),C=n=>{const u=T(n);j(b=>b.includes(u)?b.filter(w=>w!==u):[...b,u])},L=n=>{const u=le[n],b=u.icon;return e.jsxs(e.Fragment,{children:[b&&e.jsx(b,{className:"mr-1 inline-block h-4 w-4"}),u.label]})},F=n=>{const u=A[n]||[],b=12,w=v[n]?u:u.slice(0,b);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[w.map(r=>e.jsx(M.button,{type:"button",onClick:()=>C(r),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:l.includes(r)?1:.6},"aria-pressed":l.includes(r),className:"flex-shrink-0 focus:outline-none",title:f[r]?`${R(H(r))} — used in ${f[r]} herbs`:R(H(r)),children:e.jsx(q,{label:R(H(r)),variant:l.includes(r)?"green":X(r),className:V(l.includes(r)&&"ring-1 ring-emerald-400")})},r)),u.length>b&&e.jsx(M.button,{type:"button",whileHover:{scale:1.05},onClick:()=>N(r=>({...r,[n]:!r[n]})),className:"tag-pill mt-2",children:v[n]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y==null?void 0:y(g==="AND"?"OR":"AND"),className:"tag-pill",children:g==="AND"?"Match ALL":"Match ANY"}),l.length>0&&e.jsx("button",{type:"button",onClick:o,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),ce.map(n=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>h(u=>({...u,[n]:!u[n]})),"aria-expanded":a[n],children:[L(n),e.jsx(M.span,{animate:{rotate:a[n]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx(U,{initial:!1,children:a[n]&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:F(n)},"content")})]},n))]})}function me(){const t=$(),i=k.useMemo(()=>{const o={};return t==null||t.forEach(v=>{const N=v.category.split("/")[0].trim();o[N]=(o[N]||0)+1}),o},[t]),m=k.useMemo(()=>Object.entries(i).sort((o,v)=>v[1]-o[1]),[i]),[f,g]=k.useState(!1),[y,l]=k.useState(""),j=k.useMemo(()=>m.filter(([o])=>o.toLowerCase().includes(y.toLowerCase())),[m,y]),a=f?j:j.slice(0,12),h=Math.max(...m.map(([,o])=>o));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Find category",value:y,onChange:o=>l(o.target.value),className:"w-36 flex-1 rounded-md bg-space-dark/50 px-2 py-1 text-sm backdrop-blur-md"}),e.jsx("button",{type:"button",onClick:()=>g(o=>!o),className:"tag-pill",children:f?"Collapse":"Show All"})]}),e.jsx("div",{className:"space-y-2",children:a.map(([o,v])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{text:`${v} herbs`,children:e.jsx("span",{className:"w-40 truncate text-sm",children:o})}),e.jsx("div",{className:"h-2 flex-1 rounded bg-slate-700/50",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${v/h*100}%`}})})]},o))})]})}function ue(t){const i=t.match(/\(([^)]+)\)/);return i?i[1].split(/[,/]| or /).map(m=>m.trim()).filter(Boolean):[]}const z={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function Z(t){const i=t.toLowerCase();return/(empathogen|euphoriant)/.test(i)?"Empathogen":/(psychedelic|visionary)/.test(i)?"Psychedelic":/dissociative|sedative/.test(i)?"Dissociative":/oneirogen|dream/.test(i)?"Oneirogen":"Other"}function he(t,i={}){const{favorites:m=[]}=i,f=t??[],[g,y]=c.useState(""),[l,j]=c.useState([]),[a,h]=c.useState("AND"),[o,v]=c.useState(!1),[N,A]=P("dbCategories",[]),[C,L]=c.useState(""),F=c.useMemo(()=>f.map(r=>({...r,aliases:[...ue(r.name),...z[r.id]||z[r.name.toLowerCase()]||[]],tagAliases:r.tags.map(E=>ee(T(E))).filter(Boolean)})),[f]),n=c.useMemo(()=>new ne(F,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[F]),[u,b]=c.useState({});return{filtered:c.useMemo(()=>{let r=[];const E=g.trim();E?r=n.search(E):r=f.map(x=>({item:x}));const O={};r.forEach(x=>{x.matches&&(O[x.item.id]=x.matches)}),b(O);let S=r.map(x=>x.item);return l.length&&(S=S.filter(x=>{const s=l.map(d=>x.tags.some(p=>T(p)===T(d)));return a==="AND"?s.every(Boolean):s.some(Boolean)})),N.length&&(S=S.filter(x=>N.includes(Z(x.category)))),o&&(S=S.filter(x=>m.includes(x.id))),C==="name"&&(S=[...S].sort((x,s)=>x.name.localeCompare(s.name))),S},[f,g,l,N,o,m,C,n]),matches:u,query:g,setQuery:y,tags:l,setTags:j,tagMode:a,setTagMode:h,categories:N,setCategories:A,favoritesOnly:o,setFavoritesOnly:v,sort:C,setSort:L,fuse:n}}function pe({selected:t,onChange:i}){const m=$(),[f,g]=k.useState(!1),y=c.useMemo(()=>{const a={};return m==null||m.forEach(h=>{const o=Z(h.category);a[o]=(a[o]||0)+1}),a},[m]),l=a=>{const h=t.includes(a)?t.filter(o=>o!==a):[...t,a];i==null||i(h)},j=e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(y).sort((a,h)=>h[1]-a[1]).map(([a,h])=>e.jsxs("button",{type:"button",onClick:()=>l(a),className:`tag-pill max-w-[7rem] truncate ${t.includes(a)?"ring-2 ring-emerald-400":""}`,children:[a," (",h,")"]},a))});return e.jsxs("div",{children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>g(a=>!a),className:"tag-pill mb-2",children:f?"Hide Categories":"Show Categories"}),e.jsx(U,{initial:!1,children:f&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:j},"cats")})]}),e.jsx("div",{className:"hidden sm:block",children:j})]})}function fe({query:t,setQuery:i,fuse:m}){const[f,g]=c.useState([]),[y,l]=c.useState(!1);c.useEffect(()=>{l(!0);const a=t.trim(),h=setTimeout(()=>{g(a?m.search(a,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),l(!1)},200);return()=>clearTimeout(h)},[t,m]);const j=a=>{if(!t)return a;const h=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${h})`,"ig");return a.replace(o,'<mark class="rounded bg-yellow-500/40 px-1">$1</mark>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:a=>i(a.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),y&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!y&&f.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:f.map(a=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>i(a.item.name),dangerouslySetInnerHTML:{__html:j(a.item.name)}})},a.item.id))})]})}function xe(t,i){try{const m=localStorage.getItem(t);return m?JSON.parse(m):i}catch{return i}}function G(t,i){try{localStorage.setItem(t,JSON.stringify(i))}catch{}}function Te(){const t=$();console.log("herbs length",t?t.length:"loading");const{favorites:i}=J(),{filtered:m,matches:f,query:g,setQuery:y,tags:l,setTags:j,categories:a,setCategories:h,tagMode:o,setTagMode:v,favoritesOnly:N,setFavoritesOnly:A,fuse:C}=he(t,{favorites:i}),[L,F]=P("dbCompact",!1),[n,u]=_();if(t===void 0)return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx("title",{children:"Database - The Hippie Scientist"})}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(I,{}),e.jsx("div",{className:"text-center text-sand",children:"Loading herb data…"})]})]});if(t.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx("title",{children:"Database - The Hippie Scientist"})}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(I,{}),e.jsx("div",{className:"text-center text-sand",children:"Unable to load herb data."})]})]});c.useEffect(()=>{const s=xe("dbScroll",0);s&&window.scrollTo(0,s);const d=()=>G("dbScroll",window.scrollY);return window.addEventListener("scroll",d),()=>{G("dbScroll",window.scrollY),window.removeEventListener("scroll",d)}},[]),c.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const d=document.getElementById(s);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const b=c.useMemo(()=>{if(!t)return[];const s=t.reduce((d,p)=>d.concat(p.tags),[]);return Array.from(new Set(s.map(T)))},[t]),w=c.useMemo(()=>{const s={};return t==null||t.forEach(d=>{d.tags.forEach(p=>{const Y=T(p);s[Y]=(s[Y]||0)+1})}),s},[t]);c.useEffect(()=>{Object.keys(w).length&&console.log("Tag usage counts",w)},[w]);const[r,E]=c.useState(!1),[O,S]=c.useState(!0);c.useEffect(()=>{const s=n.get("tags");if(s){const d=s.split(",").map(p=>decodeURIComponent(p));j(d)}},[]),c.useEffect(()=>{l.length>0?n.set("tags",l.map(encodeURIComponent).join(",")):n.delete("tags"),u(n,{replace:!0})},[l,n,u]),c.useEffect(()=>{let s=window.scrollY;const d=()=>{const p=window.scrollY;S(p<s||p<100),s=p};return window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]),c.useEffect(()=>{const s=()=>{window.scrollY>150&&E(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[l,a,g]);const x=c.useMemo(()=>{if(l.length===0)return[];const s={};return t==null||t.forEach(d=>{l.every(p=>d.tags.includes(p))&&d.tags.forEach(p=>{l.includes(p)||(s[p]=(s[p]||0)+1)})}),Object.entries(s).sort((d,p)=>p[1]-d[1]).slice(0,5).map(([d])=>d)},[l,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(I,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(M.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:O?0:-60,opacity:O?1:0},transition:{duration:.3},children:[e.jsx(fe,{query:g,setQuery:y,fuse:C}),e.jsx("button",{type:"button",onClick:()=>A(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:N?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>F(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:L?"Full Cards":"Compact"}),e.jsx("button",{type:"button",onClick:()=>E(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:r?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${r?"":"hidden sm:block"}`,children:[e.jsx(pe,{selected:a,onChange:h}),e.jsx(de,{tags:b,counts:w,onChange:j,mode:o,onModeChange:v})]}),x.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),x.map(s=>e.jsx("button",{type:"button",onClick:()=>j(d=>Array.from(new Set([...d,s]))),className:"tag-pill",children:R(s)},s))]}),e.jsx(me,{}),e.jsx(Q,{herbs:m,highlightQuery:g,matches:f,compact:L,pageSize:30})]})]})]})}export{Te as default};
