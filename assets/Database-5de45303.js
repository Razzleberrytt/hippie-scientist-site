import{j as e,m as f,e as v,R as c,h as M,p as z,q as P,v as b,W as V,L as _,D as J}from"./main-1c05fd05.js";import{H as W}from"./HerbList-7d561f0b.js";import{m as Z,u as Q}from"./useFilteredHerbs-3f6b9f6f.js";import{S as G}from"./StarfieldBackground-c59fadd9.js";import{u as K}from"./useHerbs-d9eeecda.js";const L={type:"spring",stiffness:220,damping:20},X={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};function q({allTags:n,activeTags:o,onToggleTag:m}){const d=t=>{m(t)},i=()=>{o.forEach(t=>m(t))},u={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{staggerChildren:.05}}},h=X;return e.jsxs(f.div,{variants:u,initial:"hidden",animate:"visible",className:"no-scrollbar flex items-center gap-2 overflow-x-auto py-2",children:[e.jsx("span",{className:"pl-1 pr-2 text-xs font-semibold text-opal",children:o.length>0?`Filtered (${o.length})`:"Filter Tags"}),n.map(t=>{const l=o.includes(t);return e.jsx(f.button,{variants:h,type:"button","aria-pressed":l,"aria-label":`${l?"Remove":"Add"} filter ${v(t)}`,onClick:()=>d(t),whileTap:{scale:.9},whileHover:{scale:1.08},animate:l?{scale:[1,1.15,1],boxShadow:"0 0 8px rgba(16,185,129,0.8)"}:{scale:1,boxShadow:"none"},transition:{...L,repeat:l?1/0:0,repeatType:"mirror",duration:1.2},className:`tag-pill hover-glow whitespace-nowrap transition-colors duration-300 ${l?"bg-emerald-700/70 text-white ring-2 ring-emerald-400 dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:v(t)},t)}),o.length>0&&e.jsx(f.button,{type:"button","aria-label":"Clear all filters",onClick:i,whileTap:{scale:.9},whileHover:{scale:1.08},transition:L,className:"tag-pill hover-glow whitespace-nowrap bg-rose-700/70 text-white transition-colors duration-300 dark:bg-rose-800",children:"Clear Filters"})]})}const C=5;function ee(){const n=c.useMemo(()=>{const t={};return M.forEach(l=>{const w=(typeof l.category=="string"?l.category:"Unknown").split("/")[0].trim();t[w]=(t[w]||0)+1}),t},[]),o=c.useMemo(()=>Object.entries(n).sort((t,l)=>l[1]-t[1]),[n]),[m,d]=c.useState(!1),i=c.useMemo(()=>m?o:o.filter(([,t])=>t>=C),[o,m]),u=c.useMemo(()=>o.some(([,t])=>t<C),[o]),h=Math.max(...o.map(([,t])=>t));return e.jsxs("div",{className:"relative space-y-2",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[i.map(([t,l])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:t}),e.jsx("div",{className:"flex-1 h-2 rounded bg-gray-200 dark:bg-gray-700 transition-colors duration-300",children:e.jsx("div",{className:"h-2 rounded bg-pink-500 dark:bg-pink-400 transition-colors duration-300",style:{width:`${l/h*100}%`}})}),e.jsx("span",{className:"text-sm",children:l})]},t)),u&&!m&&e.jsx("div",{className:"pointer-events-none text-center text-xs text-moss",children:"Hover to show more"})]})}function te({selected:n,onChange:o}){const m=c.useMemo(()=>{const i={};return M.forEach(u=>{const h=Z(u.category);i[h]=(i[h]||0)+1}),i},[]),d=i=>{const u=n.includes(i)?n.filter(h=>h!==i):[...n,i];o==null||o(u)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(m).sort((i,u)=>u[1]-i[1]).map(([i,u])=>e.jsxs("button",{type:"button",onClick:()=>d(i),className:`tag-pill transition-colors duration-300 ${n.includes(i)?"ring-2 ring-emerald-400 bg-emerald-700/70 text-white dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:[i," (",u,")"]},i))})}function se({query:n,setQuery:o,fuse:m}){const[d,i]=c.useState([]);c.useEffect(()=>{const t=n.trim();i(t?m.search(t,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[])},[n,m]);const u=t=>{if(!n)return t;const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),x=new RegExp(`(${l})`,"ig");return t.replace(x,'<span class="font-bold">$1</span>')},h=t=>{const l=[t.item.name,...t.item.altNames||[]].join(", ");return u(l)};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...","aria-label":"Search herbs",tabIndex:0,value:n,onChange:t=>o(t.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),d.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:d.map(t=>e.jsx("li",{children:e.jsx("button",{type:"button",tabIndex:0,"aria-label":`Select ${t.item.name}`,className:"w-full text-left rounded px-2 py-1 hover:bg-white/10",onClick:()=>o(t.item.name),dangerouslySetInnerHTML:{__html:h(t)}})},t.item.id))})]})}function re(n,o){try{const m=localStorage.getItem(n);return m?JSON.parse(m):o}catch{return o}}function A(n,o){try{localStorage.setItem(n,JSON.stringify(o))}catch{}}function ce(){const{herbs:n,loading:o,error:m}=K();if(o)return e.jsx(z,{});if(m)return e.jsx("div",{className:"min-h-screen px-4 pt-20 text-center",children:e.jsx("p",{className:"text-red-500",children:"Failed to load herb data."})});const d=c.useMemo(()=>{const s=r=>r&&typeof r.name=="string"&&typeof r.slug=="string"&&Array.isArray(r.tags)&&Array.isArray(r.effects),a=n.filter(r=>!s(r));return a.length&&console.error("Filtered invalid herb entries:",a),n.filter(s)},[n]),{favorites:i}=P(),{filtered:u,query:h,setQuery:t,tags:l,setTags:x,matchAll:w,setMatchAll:F,categories:T,setCategories:H,favoritesOnly:O,setFavoritesOnly:$,sort:I,setSort:B,fuse:D}=Q(d,{favorites:i});c.useEffect(()=>{var r;const a=((r=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:r.split(","))||[];a.length&&setTimeout(()=>{a.forEach(p=>{const g=document.getElementById(`herb-${p}`);g&&(g.scrollIntoView({behavior:"smooth"}),g.classList.add("ring-2","ring-sky-300"),setTimeout(()=>g.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),c.useEffect(()=>{const s=re("dbScroll",0);s&&window.scrollTo(0,s);const a=()=>A("dbScroll",window.scrollY);return window.addEventListener("scroll",a),()=>{A("dbScroll",window.scrollY),window.removeEventListener("scroll",a)}},[]);const R=c.useMemo(()=>{const s=d.reduce((a,r)=>a.concat(r.tags),[]);return Array.from(new Set(s.map(b)))},[d]),y=c.useMemo(()=>{const s=d.filter(r=>r.affiliateLink&&r.affiliateLink.startsWith("http")).length,a=d.filter(r=>r.mechanismOfAction&&r.mechanismOfAction.trim()).length;return{total:d.length,affiliates:s,moaCount:a}},[d]),Y=c.useCallback(s=>x(a=>a.includes(s)?a.filter(r=>r!==s):[...a,s]),[x]),j=n.length-d.length,[k,N]=c.useState(!1),[S,U]=c.useState(!0);c.useEffect(()=>{const s={current:window.scrollY},a=()=>{const r=window.scrollY;U(r<s.current||r<100),s.current=r};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),c.useEffect(()=>{const s=()=>{window.scrollY>150&&N(!1)};return window.addEventListener("scroll",s,{passive:!0}),window.addEventListener("touchmove",s,{passive:!0}),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]);const E=c.useMemo(()=>{if(l.length===0)return[];const s={};return n.forEach(a=>{l.every(r=>a.tags.some(p=>b(p)===b(r)))&&a.tags.forEach(r=>{const p=b(r);l.some(g=>b(g)===p)||(s[p]=(s[p]||0)+1)})}),Object.entries(s).sort((a,r)=>r[1]-a[1]).slice(0,5).map(([a])=>a)},[l,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(G,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(f.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:S?0:-60,opacity:S?1:0},transition:{duration:.3},children:[e.jsx(se,{query:h,setQuery:t,fuse:D}),e.jsx("button",{type:"button",onClick:()=>$(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:O?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>F(s=>!s),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:w?"Match ALL":"Match ANY"}),e.jsxs("select",{value:I,onChange:s=>B(s.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[e.jsx("option",{value:"",children:"Sort By..."}),e.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),e.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),e.jsx(_,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:e.jsx(J,{size:18})}),e.jsx("button",{type:"button",onClick:()=>N(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:k?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${k?"":"hidden sm:block"}`,children:[e.jsx(te,{selected:T,onChange:H}),e.jsx(q,{allTags:R,activeTags:l,onToggleTag:Y})]}),E.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),E.map(s=>e.jsx("button",{type:"button",onClick:()=>x(a=>Array.from(new Set([...a,s]))),className:"tag-pill",children:v(s)},s))]}),e.jsx(ee,{}),j>0&&e.jsxs("p",{className:"mb-2 rounded-md border border-red-500/40 bg-red-500/10 p-2 text-center text-sm text-red-300",children:[j," entries contained errors and were hidden. Please report this issue."]}),(()=>{try{return e.jsx(W,{herbs:u,highlightQuery:h})}catch(s){return console.error("Failed to render herb list",s),e.jsx("p",{className:"text-center text-red-500",children:"Error loading herb entries."})}})(),e.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",y.total," · Affiliate links: ",y.affiliates," · MOA documented:"," ",y.moaCount," · Updated: ",new Date("2025-07-24T23:58:57.685Z").toLocaleDateString()]})]})]})]})}export{ce as default};
