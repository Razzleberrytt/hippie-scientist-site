import{l as Se,j as c,E as Me,r as H,R as E,m as w,A as fe,L as se,W as ze,D as Ke}from"./main-8107ca7e.js";import{c as B,d as Q,t as we,n as Z,b as Ve,a as Fe,h as We}from"./herbs-8a0b8949.js";import{u as De,T as W,I as ne,s as ge,c as Ye}from"./useLocalStorage-17c46a94.js";import{s as ie}from"./slugify-386a61cd.js";import{s as V}from"./safeHerbField-1fbb551f.js";import{S as q}from"./StarfieldBackground-f5f24da3.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=Se("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Se("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Je="Unknown",Xe="Not well documented";function ke(){const[e,t]=De("herbFavorites",[]);return{favorites:e,toggle:n=>{t(a=>a.includes(n)?a.filter(i=>i!==n):[...a,n])},isFavorite:n=>e.includes(n)}}function re(){return c.jsx("div",{className:"hover-glow card-contrast relative overflow-hidden rounded-2xl bg-gray-700/40 p-6 text-center text-sand backdrop-blur-md",children:"âš ï¸ This herb entry is incomplete"})}const Ze={Oneirogen:"blue",Dissociative:"purple",Psychedelic:"purple",Empathogen:"pink",Stimulant:"yellow",Other:"yellow"},qe={hidden:{},visible:{transition:{staggerChildren:.05}}},U={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},ee=2,Y={mechanismOfAction:"How this herb produces its effects in the body.",toxicity:"Known adverse effects or poisoning information.",therapeuticUses:"Traditional or potential healing applications.",contraindications:"Situations where this herb should be avoided.",dosage:"Common oral or smoked amount for effects."};function et(e){const t=e.toLowerCase();return t.includes("oneirogen")?"from-indigo-700/40 to-purple-700/40":t.includes("psychedelic")?"from-fuchsia-700/40 to-pink-700/40":t.includes("dissociative")?"from-purple-700/40 to-violet-700/40":t.includes("empathogen")?"from-rose-700/40 to-pink-600/40":t.includes("stimulant")?"from-orange-700/40 to-amber-700/40":"from-white/10 to-white/5"}function tt({herb:e,highlight:t=""}){var s,r,n,a;try{if(!e||!e.name)return console.warn("Skipping malformed herb:",e),c.jsx(re,{});const i={...e,name:V(e.name,"Unknown Herb"),effects:Array.isArray(e.effects)?e.effects:[],category:V(e.category,"Other"),tags:Array.isArray(e.tags)?e.tags:[],description:V(e.description,""),slug:e.slug||ie(V(e.name,""))},[o,l]=H.useState(!1),[u,d]=H.useState(!1),[p,y]=H.useState({}),A=h=>y(v=>({...v,[h]:!v[h]})),m=()=>l(h=>!h),{isFavorite:C,toggle:b}=ke(),j=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),m())},F=h=>{if(!t)return h;const v=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),M=new RegExp(`(${v})`,"ig");return h.replace(M,'<span class="font-bold text-yellow-300">$1</span>')},S=E.useMemo(()=>{var v;const h=new Set(((v=i.activeConstituents)==null?void 0:v.map(M=>B(M.name)))||[]);return[...i.tags].sort((M,g)=>{const f=h.has(B(M)),N=h.has(B(g));return f===N?0:f?-1:1})},[i]),D=et(((s=i.normalizedCategories)==null?void 0:s[0])||i.category);return c.jsxs(w.article,{id:`herb-${i.id}`,layout:!0,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},exit:{opacity:0,scale:.9},onClick:m,onKeyDown:j,tabIndex:0,role:"button","aria-expanded":o,"aria-label":`Herb card for ${i.name}`,whileHover:{scale:1.03,boxShadow:"0 0 20px rgba(255,255,255,0.2)",backgroundColor:"rgba(255,255,255,0.1)"},whileTap:{scale:.97},transition:{layout:{duration:.4,ease:"easeInOut"}},className:`hover-glow card-contrast relative cursor-pointer overflow-hidden rounded-2xl bg-gradient-to-br ${D} border border-white/10 p-3 shadow-lg shadow-black/50 ring-1 ring-white/30 backdrop-blur-lg hover:shadow-psychedelic-pink/40 hover:drop-shadow-2xl focus:outline-none focus-visible:shadow-intense focus-visible:ring-2 focus-visible:ring-4 focus-visible:ring-psychedelic-pink focus-visible:ring-sky-400 focus-visible:ring-offset-2 focus-visible:ring-offset-space-dark sm:p-6`,children:[c.jsx(w.span,{initial:{opacity:0,y:-4},whileHover:{opacity:1,y:0},whileTap:{opacity:1,y:0},className:"pointer-events-none absolute right-4 top-2 text-xs text-sand",children:"+ More Info"}),c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"min-w-0",children:[c.jsx("div",{className:"flex flex-wrap items-baseline gap-1",children:c.jsx("h3",{className:"text-shadow mb-0.5 font-herb text-xl text-white sm:text-2xl",dangerouslySetInnerHTML:{__html:F(i.name)}})}),i.scientificName&&c.jsx("p",{className:"mt-0.5 text-xs italic text-sand",dangerouslySetInnerHTML:{__html:F(i.scientificName)}}),((r=i.normalizedCategories)==null?void 0:r.length)>0&&c.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:i.normalizedCategories.slice(0,3).map(h=>c.jsx(W,{label:h,variant:Ze[h]||"purple"},h))}),c.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-sm text-sand sm:text-base",children:[(()=>{const h=Array.isArray(i.effects)?i.effects.join(", "):i.effects;return h?c.jsx("span",{children:h}):null})(),i.affiliateLink&&c.jsx("a",{href:i.affiliateLink,target:"_blank",rel:"noopener noreferrer",onClick:h=>h.stopPropagation(),className:"rounded bg-lime-700/40 px-2 py-0.5 text-xs text-lime-200 hover:underline",children:"Buy Online"})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{type:"button",onClick:h=>{h.stopPropagation(),b(i.id)},"aria-label":C(i.id)?"Remove favorite":"Add favorite",className:"rounded-md p-1 text-yellow-400 hover:bg-white/10",children:c.jsx(Qe,{fill:C(i.id)?"currentColor":"none",size:18})}),c.jsx(w.span,{layout:!0,initial:!1,animate:{rotate:o?90:0},transition:{duration:.3},className:"text-cyan-200 transition-transform",children:c.jsx(Ge,{size:18})})]})]}),c.jsxs(w.div,{layout:!0,onHoverStart:()=>d(!0),onHoverEnd:()=>d(!1),className:"mt-2 flex flex-wrap gap-1 text-xs sm:gap-2 sm:text-sm",children:[(u?S:S.slice(0,ee)).map(h=>c.jsx(W,{label:Q(h),variant:we(h),className:o?"animate-pulse":""},h)),S.length>ee&&!u&&c.jsx(W,{label:`+${S.length-ee} more`,variant:"yellow"})]}),c.jsx(fe,{initial:!1,children:o&&c.jsx(w.div,{layout:!0,initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},transition:{duration:.4,ease:"easeInOut"},className:"mt-4 overflow-hidden whitespace-pre-line break-words text-sm text-sand sm:text-base",children:c.jsxs(w.div,{variants:qe,initial:"hidden",animate:"visible",exit:"hidden",className:"space-y-3",children:[function(){try{const h=["description","mechanismOfAction","therapeuticUses","sideEffects","contraindications","drugInteractions","preparation","dosage","pharmacokinetics","onset","duration","intensity","region","legalStatus"],v=new Set(["id","name","slug","tags","category","normalizedCategories","affiliateLink","activeConstituents","scientificName","effects"]),M=Object.keys(i).filter(f=>!v.has(f)&&!h.includes(f));return[...h,...M].map(f=>{const N=i[f],k=Array.isArray(N),L=k?Array.isArray(N)?N:[]:V(N,"");if(!k&&L==="")return f==="description"?c.jsxs(w.div,{variants:U,children:[c.jsx("span",{className:"font-semibold text-lime-300",children:"Description:"})," ",Xe]},f):f==="mechanismOfAction"||f==="toxicity"||f==="toxicityLD50"?c.jsxs(w.div,{variants:U,children:[c.jsxs("span",{className:"font-semibold text-lime-300",children:[f.replace(/([A-Z])/g," $1")+":",Y[f]&&c.jsx(ne,{text:Y[f]})]})," ",Je]},f):null;const K=k?L.join(", "):String(L);if(!K.trim())return null;const I=c.jsx("span",{className:p[f]||K.length<200?"":"line-clamp-2",children:K});return c.jsxs(w.div,{variants:U,children:[c.jsxs("span",{className:"font-semibold text-lime-300",children:[f.replace(/([A-Z])/g," $1")+":",Y[f]&&c.jsx(ne,{text:Y[f]})]})," ",I,K.length>200&&c.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),A(f)},"aria-expanded":!!p[f],className:"ml-2 text-sky-300 underline",children:p[f]?"Show Less":"Show More"})]},f)})}catch(h){return console.error("Render fields failed",h),null}}(),((n=i.activeConstituents)==null?void 0:n.length)>0&&c.jsxs(w.div,{variants:U,children:[c.jsx("span",{className:"font-semibold text-lime-300",children:"Active Compounds:"})," ",i.activeConstituents.map((h,v)=>c.jsxs(E.Fragment,{children:[v>0&&", ",c.jsx(se,{to:`/compounds#${ie(h.name)}`,onClick:M=>M.stopPropagation(),className:"hover-glow inline-block rounded px-1 text-sky-300 underline",children:h.name})]},h.name))]}),(i.safetyRating||i.toxicity||i.toxicityLD50)&&c.jsxs(w.div,{variants:U,className:"space-y-1 pt-2",children:[i.safetyRating&&c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold text-lime-300",children:"Safety Rating:"})," ",c.jsx(W,{label:i.safetyRating,variant:((a=i.safetyRating)==null?void 0:a.toString().toLowerCase())==="low"?"green":"purple"})]}),i.toxicity&&c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold text-lime-300",children:"Toxicity:"})," ",i.toxicity]}),i.toxicityLD50&&c.jsxs("div",{children:[c.jsx("span",{className:"font-semibold text-lime-300",children:"Toxicity LD50:"})," ",i.toxicityLD50]})]}),c.jsxs(w.div,{variants:U,className:"pt-2",children:[c.jsx(se,{to:`/herbs/${i.id}`,onClick:h=>h.stopPropagation(),className:"text-comet underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-psychedelic-pink",children:"View full page"}),i.affiliateLink&&c.jsx("a",{href:i.affiliateLink,target:"_blank",rel:"noopener noreferrer",onClick:h=>h.stopPropagation(),className:"ml-4 text-sm text-sky-300 underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-psychedelic-pink",children:"ðŸŒ Buy Online"})]})]})},"content")})]})}catch(i){return console.warn("Render herb card failed",e==null?void 0:e.name,i),c.jsx(re,{})}}function st({herb:e,highlight:t}){return!e||typeof e!="object"?null:c.jsx(Me,{children:c.jsx(tt,{herb:e,highlight:t})})}function Be(e){return!e||typeof e!="object"||!e.name||typeof e.name!="string"?!1:(Array.isArray(e.effects)||(e.effects=[]),Array.isArray(e.tags)||(e.tags=[]),e.category||(e.category="Other"),!0)}const nt={hidden:{},visible:{transition:{staggerChildren:.05}}},it={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},rt=({herbs:e,highlightQuery:t="",batchSize:s=24})=>{const[r,n]=E.useState(s),a=E.useMemo(()=>e.filter(Be).map((o,l)=>{try{return ge(o)}catch{return ge({})}}),[e]),i=()=>n(o=>Math.min(o+s,a.length));return a.length===0?c.jsx("p",{className:"text-center text-sand/80",children:"No valid herbs found."}):c.jsxs(c.Fragment,{children:[c.jsx(w.div,{layout:!0,variants:nt,initial:"hidden",animate:"visible",className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:c.jsx(fe,{children:a.slice(0,r).map((o,l)=>c.jsx(w.div,{variants:it,layout:!0,children:c.jsx(Me,{fallback:c.jsx(re,{}),children:c.jsx(st,{herb:o,highlight:t})})},o.id||o.name||l))})},a.map(o=>o.id).join("-")),r<a.length&&c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:i,className:"rounded-md bg-black/30 px-4 py-2 text-sand backdrop-blur-md hover:bg-white/10",children:"Show More"})})]})},ot=rt,pe=5,at=["Effect","Preparation","Safety","Chemistry","Region","Other"];function ct({tags:e,onChange:t,storageKey:s="tagFilters",counts:r={}}){const[n,a]=De(s,[]),[i,o]=H.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),[l,u]=H.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});H.useEffect(()=>{t==null||t(n)},[n,t]);const d=H.useMemo(()=>{const m={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return e.forEach(C=>{const b=B(Z(C)),j=Ve(b);m[j].includes(b)||m[j].push(b)}),m},[e]),p=m=>{const C=B(m);a(b=>b.includes(C)?b.filter(j=>j!==C):[...b,C])},y=m=>{switch(m){case"Effect":return"âš¡ Effects";case"Preparation":return"ðŸŒ¿ Preparation";case"Safety":return"âš ï¸ Safety";case"Chemistry":return"ðŸ§ª Chemistry";case"Region":return"ðŸ“ Region";default:return"âœ¨ Other"}},A=m=>{const C=d[m]||[],b=12,j=C.filter(v=>(r[B(v)]||0)>=pe),F=C.filter(v=>(r[B(v)]||0)<pe),S=[...j,...F],D=l[m]?S:j.slice(0,b),h=F.length>0||j.length>b;return c.jsx(c.Fragment,{children:c.jsxs("div",{className:"tag-list",children:[D.map(v=>c.jsx(w.button,{type:"button",onClick:()=>p(v),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:n.includes(v)?1:.6},"aria-pressed":n.includes(v),tabIndex:0,className:"flex-shrink-0 focus:outline-none",children:c.jsx(ne,{text:`${Q(Z(v))} â€” used in ${r[v]??r[B(v)]??0} herbs`,children:c.jsx(W,{label:Q(Z(v)),variant:n.includes(v)?"green":we(v),className:Ye(n.includes(v)&&"ring-1 ring-emerald-400")})})},v)),h&&c.jsx(w.button,{type:"button",whileHover:{scale:1.05},onClick:()=>u(v=>({...v,[m]:!v[m]})),tabIndex:0,className:"tag-pill mt-2",children:l[m]?"Show Less":"Show More"})]})})};return c.jsx("div",{className:"sticky top-16 z-20 space-y-3 rounded-xl bg-black/30 p-2 backdrop-blur-md sm:static sm:bg-transparent sm:p-0",children:at.map(m=>c.jsxs("div",{className:"tag-section",children:[c.jsxs("button",{type:"button",className:"tag-label",tabIndex:0,onClick:()=>o(C=>({...C,[m]:!C[m]})),"aria-expanded":i[m],children:[y(m),c.jsx(w.span,{animate:{rotate:i[m]?90:0},className:"ml-1 text-xs",children:"â–¶"})]}),c.jsx(fe,{initial:!1,children:i[m]&&c.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:A(m)},"content")})]},m))})}const xe=5;function lt(){const e=E.useMemo(()=>{const o={};return Fe.forEach(l=>{const u=(l.category??"").split("/")[0].trim();o[u]=(o[u]||0)+1}),o},[]),t=E.useMemo(()=>Object.entries(e).sort((o,l)=>l[1]-o[1]),[e]),[s,r]=E.useState(!1),n=E.useMemo(()=>s?t:t.filter(([,o])=>o>=xe),[t,s]),a=E.useMemo(()=>t.some(([,o])=>o<xe),[t]),i=Math.max(...t.map(([,o])=>o));return c.jsxs("div",{className:"relative space-y-2",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[n.map(([o,l])=>c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"w-40 text-sm",children:o}),c.jsx("div",{className:"flex-1 bg-slate-700/50 h-2 rounded",children:c.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${l/i*100}%`}})}),c.jsx("span",{className:"text-sm",children:l})]},o)),a&&!s&&c.jsx("div",{className:"pointer-events-none text-center text-xs text-moss",children:"Hover to show more"})]})}function R(e){return Array.isArray?Array.isArray(e):Oe(e)==="[object Array]"}const ut=1/0;function dt(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-ut?"-0":t}function ft(e){return e==null?"":dt(e)}function _(e){return typeof e=="string"}function Le(e){return typeof e=="number"}function ht(e){return e===!0||e===!1||mt(e)&&Oe(e)=="[object Boolean]"}function Ie(e){return typeof e=="object"}function mt(e){return Ie(e)&&e!==null}function O(e){return e!=null}function te(e){return!e.trim().length}function Oe(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const gt="Incorrect 'index' type",pt=e=>`Invalid value for key ${e}`,xt=e=>`Pattern length exceeds max of ${e}.`,yt=e=>`Missing ${e} property in key`,At=e=>`Property 'weight' in key '${e}' must be a positive integer`,ye=Object.prototype.hasOwnProperty;class vt{constructor(t){this._keys=[],this._keyMap={};let s=0;t.forEach(r=>{let n=_e(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function _e(e){let t=null,s=null,r=null,n=1,a=null;if(_(e)||R(e))r=e,t=Ae(e),s=oe(e);else{if(!ye.call(e,"name"))throw new Error(yt("name"));const i=e.name;if(r=i,ye.call(e,"weight")&&(n=e.weight,n<=0))throw new Error(At(i));t=Ae(i),s=oe(i),a=e.getFn}return{path:t,id:s,weight:n,src:r,getFn:a}}function Ae(e){return R(e)?e:e.split(".")}function oe(e){return R(e)?e.join("."):e}function Et(e,t){let s=[],r=!1;const n=(a,i,o)=>{if(O(a))if(!i[o])s.push(a);else{let l=i[o];const u=a[l];if(!O(u))return;if(o===i.length-1&&(_(u)||Le(u)||ht(u)))s.push(ft(u));else if(R(u)){r=!0;for(let d=0,p=u.length;d<p;d+=1)n(u[d],i,o+1)}else i.length&&n(u,i,o+1)}};return n(e,_(t)?t.split("."):t,0),r?s:s[0]}const Ct={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},jt={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},Nt={location:0,threshold:.6,distance:100},bt={useExtendedSearch:!1,getFn:Et,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var x={...jt,...Ct,...Nt,...bt};const St=/[^ ]+/g;function Mt(e=1,t=3){const s=new Map,r=Math.pow(10,t);return{get(n){const a=n.match(St).length;if(s.has(a))return s.get(a);const i=1/Math.pow(a,.5*e),o=parseFloat(Math.round(i*r)/r);return s.set(a,o),o},clear(){s.clear()}}}class he{constructor({getFn:t=x.getFn,fieldNormWeight:s=x.fieldNormWeight}={}){this.norm=Mt(s,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,_(this.docs[0])?this.docs.forEach((t,s)=>{this._addString(t,s)}):this.docs.forEach((t,s)=>{this._addObject(t,s)}),this.norm.clear())}add(t){const s=this.size();_(t)?this._addString(t,s):this._addObject(t,s)}removeAt(t){this.records.splice(t,1);for(let s=t,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(t,s){return t[this._keysMap[s]]}size(){return this.records.length}_addString(t,s){if(!O(t)||te(t))return;let r={v:t,i:s,n:this.norm.get(t)};this.records.push(r)}_addObject(t,s){let r={i:s,$:{}};this.keys.forEach((n,a)=>{let i=n.getFn?n.getFn(t):this.getFn(t,n.path);if(O(i)){if(R(i)){let o=[];const l=[{nestedArrIndex:-1,value:i}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(O(d))if(_(d)&&!te(d)){let p={v:d,i:u,n:this.norm.get(d)};o.push(p)}else R(d)&&d.forEach((p,y)=>{l.push({nestedArrIndex:y,value:p})})}r.$[a]=o}else if(_(i)&&!te(i)){let o={v:i,n:this.norm.get(i)};r.$[a]=o}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Re(e,t,{getFn:s=x.getFn,fieldNormWeight:r=x.fieldNormWeight}={}){const n=new he({getFn:s,fieldNormWeight:r});return n.setKeys(e.map(_e)),n.setSources(t),n.create(),n}function wt(e,{getFn:t=x.getFn,fieldNormWeight:s=x.fieldNormWeight}={}){const{keys:r,records:n}=e,a=new he({getFn:t,fieldNormWeight:s});return a.setKeys(r),a.setIndexRecords(n),a}function G(e,{errors:t=0,currentLocation:s=0,expectedLocation:r=0,distance:n=x.distance,ignoreLocation:a=x.ignoreLocation}={}){const i=t/e.length;if(a)return i;const o=Math.abs(r-s);return n?i+o/n:o?1:i}function Ft(e=[],t=x.minMatchCharLength){let s=[],r=-1,n=-1,a=0;for(let i=e.length;a<i;a+=1){let o=e[a];o&&r===-1?r=a:!o&&r!==-1&&(n=a-1,n-r+1>=t&&s.push([r,n]),r=-1)}return e[a-1]&&a-r>=t&&s.push([r,a-1]),s}const $=32;function Dt(e,t,s,{location:r=x.location,distance:n=x.distance,threshold:a=x.threshold,findAllMatches:i=x.findAllMatches,minMatchCharLength:o=x.minMatchCharLength,includeMatches:l=x.includeMatches,ignoreLocation:u=x.ignoreLocation}={}){if(t.length>$)throw new Error(xt($));const d=t.length,p=e.length,y=Math.max(0,Math.min(r,p));let A=a,m=y;const C=o>1||l,b=C?Array(p):[];let j;for(;(j=e.indexOf(t,m))>-1;){let M=G(t,{currentLocation:j,expectedLocation:y,distance:n,ignoreLocation:u});if(A=Math.min(M,A),m=j+d,C){let g=0;for(;g<d;)b[j+g]=1,g+=1}}m=-1;let F=[],S=1,D=d+p;const h=1<<d-1;for(let M=0;M<d;M+=1){let g=0,f=D;for(;g<f;)G(t,{errors:M,currentLocation:y+f,expectedLocation:y,distance:n,ignoreLocation:u})<=A?g=f:D=f,f=Math.floor((D-g)/2+g);D=f;let N=Math.max(1,y-f+1),k=i?p:Math.min(y+f,p)+d,L=Array(k+2);L[k+1]=(1<<M)-1;for(let I=k;I>=N;I-=1){let P=I-1,me=s[e.charAt(P)];if(C&&(b[P]=+!!me),L[I]=(L[I+1]<<1|1)&me,M&&(L[I]|=(F[I+1]|F[I])<<1|1|F[I+1]),L[I]&h&&(S=G(t,{errors:M,currentLocation:P,expectedLocation:y,distance:n,ignoreLocation:u}),S<=A)){if(A=S,m=P,m<=y)break;N=Math.max(1,2*y-m)}}if(G(t,{errors:M+1,currentLocation:y,expectedLocation:y,distance:n,ignoreLocation:u})>A)break;F=L}const v={isMatch:m>=0,score:Math.max(.001,S)};if(C){const M=Ft(b,o);M.length?l&&(v.indices=M):v.isMatch=!1}return v}function kt(e){let t={};for(let s=0,r=e.length;s<r;s+=1){const n=e.charAt(s);t[n]=(t[n]||0)|1<<r-s-1}return t}const J=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class Te{constructor(t,{location:s=x.location,threshold:r=x.threshold,distance:n=x.distance,includeMatches:a=x.includeMatches,findAllMatches:i=x.findAllMatches,minMatchCharLength:o=x.minMatchCharLength,isCaseSensitive:l=x.isCaseSensitive,ignoreDiacritics:u=x.ignoreDiacritics,ignoreLocation:d=x.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:o,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},t=l?t:t.toLowerCase(),t=u?J(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const p=(A,m)=>{this.chunks.push({pattern:A,alphabet:kt(A),startIndex:m})},y=this.pattern.length;if(y>$){let A=0;const m=y%$,C=y-m;for(;A<C;)p(this.pattern.substr(A,$),A),A+=$;if(m){const b=y-$;p(this.pattern.substr(b),b)}}else p(this.pattern,0)}searchIn(t){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(t=s?t:t.toLowerCase(),t=r?J(t):t,this.pattern===t){let C={isMatch:!0,score:0};return n&&(C.indices=[[0,t.length-1]]),C}const{location:a,distance:i,threshold:o,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let p=[],y=0,A=!1;this.chunks.forEach(({pattern:C,alphabet:b,startIndex:j})=>{const{isMatch:F,score:S,indices:D}=Dt(t,C,b,{location:a+j,distance:i,threshold:o,findAllMatches:l,minMatchCharLength:u,includeMatches:n,ignoreLocation:d});F&&(A=!0),y+=S,F&&D&&(p=[...p,...D])});let m={isMatch:A,score:A?y/this.chunks.length:1};return A&&n&&(m.indices=p),m}}class T{constructor(t){this.pattern=t}static isMultiMatch(t){return ve(t,this.multiRegex)}static isSingleMatch(t){return ve(t,this.singleRegex)}search(){}}function ve(e,t){const s=e.match(t);return s?s[1]:null}class Bt extends T{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const s=t===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Lt extends T{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class It extends T{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const s=t.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Ot extends T{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const s=!t.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,t.length-1]}}}class _t extends T{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const s=t.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class Rt extends T{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const s=!t.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,t.length-1]}}}class $e extends T{constructor(t,{location:s=x.location,threshold:r=x.threshold,distance:n=x.distance,includeMatches:a=x.includeMatches,findAllMatches:i=x.findAllMatches,minMatchCharLength:o=x.minMatchCharLength,isCaseSensitive:l=x.isCaseSensitive,ignoreDiacritics:u=x.ignoreDiacritics,ignoreLocation:d=x.ignoreLocation}={}){super(t),this._bitapSearch=new Te(t,{location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:o,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class He extends T{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let s=0,r;const n=[],a=this.pattern.length;for(;(r=t.indexOf(this.pattern,s))>-1;)s=r+a,n.push([r,s-1]);const i=!!n.length;return{isMatch:i,score:i?0:1,indices:n}}}const ae=[Bt,He,It,Ot,Rt,_t,Lt,$e],Ee=ae.length,Tt=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,$t="|";function Ht(e,t={}){return e.split($t).map(s=>{let r=s.trim().split(Tt).filter(a=>a&&!!a.trim()),n=[];for(let a=0,i=r.length;a<i;a+=1){const o=r[a];let l=!1,u=-1;for(;!l&&++u<Ee;){const d=ae[u];let p=d.isMultiMatch(o);p&&(n.push(new d(p,t)),l=!0)}if(!l)for(u=-1;++u<Ee;){const d=ae[u];let p=d.isSingleMatch(o);if(p){n.push(new d(p,t));break}}}return n})}const Pt=new Set([$e.type,He.type]);class Ut{constructor(t,{isCaseSensitive:s=x.isCaseSensitive,ignoreDiacritics:r=x.ignoreDiacritics,includeMatches:n=x.includeMatches,minMatchCharLength:a=x.minMatchCharLength,ignoreLocation:i=x.ignoreLocation,findAllMatches:o=x.findAllMatches,location:l=x.location,threshold:u=x.threshold,distance:d=x.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:a,findAllMatches:o,ignoreLocation:i,location:l,threshold:u,distance:d},t=s?t:t.toLowerCase(),t=r?J(t):t,this.pattern=t,this.query=Ht(this.pattern,this.options)}static condition(t,s){return s.useExtendedSearch}searchIn(t){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:a}=this.options;t=n?t:t.toLowerCase(),t=a?J(t):t;let i=0,o=[],l=0;for(let u=0,d=s.length;u<d;u+=1){const p=s[u];o.length=0,i=0;for(let y=0,A=p.length;y<A;y+=1){const m=p[y],{isMatch:C,indices:b,score:j}=m.search(t);if(C){if(i+=1,l+=j,r){const F=m.constructor.type;Pt.has(F)?o=[...o,...b]:o.push(b)}}else{l=0,i=0,o.length=0;break}}if(i){let y={isMatch:!0,score:l/i};return r&&(y.indices=o),y}}return{isMatch:!1,score:1}}}const ce=[];function zt(...e){ce.push(...e)}function le(e,t){for(let s=0,r=ce.length;s<r;s+=1){let n=ce[s];if(n.condition(e,t))return new n(e,t)}return new Te(e,t)}const X={AND:"$and",OR:"$or"},ue={PATH:"$path",PATTERN:"$val"},de=e=>!!(e[X.AND]||e[X.OR]),Kt=e=>!!e[ue.PATH],Vt=e=>!R(e)&&Ie(e)&&!de(e),Ce=e=>({[X.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Pe(e,t,{auto:s=!0}={}){const r=n=>{let a=Object.keys(n);const i=Kt(n);if(!i&&a.length>1&&!de(n))return r(Ce(n));if(Vt(n)){const l=i?n[ue.PATH]:a[0],u=i?n[ue.PATTERN]:n[l];if(!_(u))throw new Error(pt(l));const d={keyId:oe(l),pattern:u};return s&&(d.searcher=le(u,t)),d}let o={children:[],operator:a[0]};return a.forEach(l=>{const u=n[l];R(u)&&u.forEach(d=>{o.children.push(r(d))})}),o};return de(e)||(e=Ce(e)),r(e)}function Wt(e,{ignoreFieldNorm:t=x.ignoreFieldNorm}){e.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:a,score:i})=>{const o=n?n.weight:null;r*=Math.pow(i===0&&o?Number.EPSILON:i,(o||1)*(t?1:a))}),s.score=r})}function Yt(e,t){const s=e.matches;t.matches=[],O(s)&&s.forEach(r=>{if(!O(r.indices)||!r.indices.length)return;const{indices:n,value:a}=r;let i={indices:n,value:a};r.key&&(i.key=r.key.src),r.idx>-1&&(i.refIndex=r.idx),t.matches.push(i)})}function Gt(e,t){t.score=e.score}function Qt(e,t,{includeMatches:s=x.includeMatches,includeScore:r=x.includeScore}={}){const n=[];return s&&n.push(Yt),r&&n.push(Gt),e.map(a=>{const{idx:i}=a,o={item:t[i],refIndex:i};return n.length&&n.forEach(l=>{l(a,o)}),o})}class z{constructor(t,s={},r){this.options={...x,...s},this.options.useExtendedSearch,this._keyStore=new vt(this.options.keys),this.setCollection(t,r)}setCollection(t,s){if(this._docs=t,s&&!(s instanceof he))throw new Error(gt);this._myIndex=s||Re(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){O(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const a=this._docs[r];t(a,r)&&(this.removeAt(r),r-=1,n-=1,s.push(a))}return s}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:a,sortFn:i,ignoreFieldNorm:o}=this.options;let l=_(t)?_(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return Wt(l,{ignoreFieldNorm:o}),a&&l.sort(i),Le(s)&&s>-1&&(l=l.slice(0,s)),Qt(l,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(t){const s=le(t,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:a,i,n:o})=>{if(!O(a))return;const{isMatch:l,score:u,indices:d}=s.searchIn(a);l&&n.push({item:a,idx:i,matches:[{score:u,value:a,norm:o,indices:d}]})}),n}_searchLogical(t){const s=Pe(t,this.options),r=(o,l,u)=>{if(!o.children){const{keyId:p,searcher:y}=o,A=this._findMatches({key:this._keyStore.get(p),value:this._myIndex.getValueForItemAtKeyId(l,p),searcher:y});return A&&A.length?[{idx:u,item:l,matches:A}]:[]}const d=[];for(let p=0,y=o.children.length;p<y;p+=1){const A=o.children[p],m=r(A,l,u);if(m.length)d.push(...m);else if(o.operator===X.AND)return[]}return d},n=this._myIndex.records,a={},i=[];return n.forEach(({$:o,i:l})=>{if(O(o)){let u=r(s,o,l);u.length&&(a[l]||(a[l]={idx:l,item:o,matches:[]},i.push(a[l])),u.forEach(({matches:d})=>{a[l].matches.push(...d)}))}}),i}_searchObjectList(t){const s=le(t,this.options),{keys:r,records:n}=this._myIndex,a=[];return n.forEach(({$:i,i:o})=>{if(!O(i))return;let l=[];r.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:i[d],searcher:s}))}),l.length&&a.push({idx:o,item:i,matches:l})}),a}_findMatches({key:t,value:s,searcher:r}){if(!O(s))return[];let n=[];if(R(s))s.forEach(({v:a,i,n:o})=>{if(!O(a))return;const{isMatch:l,score:u,indices:d}=r.searchIn(a);l&&n.push({score:u,key:t,value:a,idx:i,norm:o,indices:d})});else{const{v:a,n:i}=s,{isMatch:o,score:l,indices:u}=r.searchIn(a);o&&n.push({score:l,key:t,value:a,norm:i,indices:u})}return n}}z.version="7.1.0";z.createIndex=Re;z.parseIndex=wt;z.config=x;z.parseQuery=Pe;zt(Ut);function Ue(e){const t=e.toLowerCase();return/(empathogen|euphoriant)/.test(t)?"Empathogen":/(psychedelic|visionary)/.test(t)?"Psychedelic":/dissociative|sedative/.test(t)?"Dissociative":/oneirogen|dream/.test(t)?"Oneirogen":"Other"}function Jt(e,t={}){const{favorites:s=[]}=t,[r,n]=E.useState(""),[a,i]=E.useState([]),[o,l]=E.useState(!0),[u,d]=E.useState(!1),[p,y]=E.useState([]),[A,m]=E.useState(""),C=E.useMemo(()=>new z(e,{keys:["name","altNames","scientificName","effects","tags"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[e]);return{filtered:E.useMemo(()=>{let j=e;const F=r.trim();return F&&(j=C.search(F).map(S=>S.item)),a.length&&(j=j.filter(S=>o?a.every(D=>S.tags.some(h=>B(h)===B(D))):a.some(D=>S.tags.some(h=>B(h)===B(D))))),p.length&&(j=j.filter(S=>p.includes(Ue(S.category)))),u&&(j=j.filter(S=>s.includes(S.id))),A==="name"&&(j=[...j].sort((S,D)=>S.name.localeCompare(D.name))),j},[e,r,a,p,u,s,A,C,o]),query:r,setQuery:n,tags:a,setTags:i,matchAll:o,setMatchAll:l,categories:p,setCategories:y,favoritesOnly:u,setFavoritesOnly:d,sort:A,setSort:m,fuse:C}}function Xt({selected:e,onChange:t}){const s=E.useMemo(()=>{const n={};return Fe.forEach(a=>{const i=Ue(a.category);n[i]=(n[i]||0)+1}),n},[]),r=n=>{const a=e.includes(n)?e.filter(i=>i!==n):[...e,n];t==null||t(a)};return c.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s).sort((n,a)=>a[1]-n[1]).map(([n,a])=>c.jsxs("button",{type:"button",onClick:()=>r(n),className:`tag-pill ${e.includes(n)?"ring-2 ring-emerald-400":""}`,children:[n," (",a,")"]},n))})}function je(e){if(!e||typeof e!="object")return null;if(typeof e.name!="string"||!e.name.trim())return console.warn("Skipping herb with invalid name",e),null;const t=Array.isArray(e.tags)?e.tags.filter(n=>typeof n=="string"&&n.trim()):[];Array.isArray(e.tags)||console.warn(`Herb ${e.name} missing tags array`);const s=Array.isArray(e.effects)?e.effects.filter(n=>typeof n=="string"&&n.trim()):[];return{id:typeof e.id=="string"&&e.id.trim()?e.id:ie(e.name),name:e.name.trim(),category:typeof e.category=="string"&&e.category.trim()?e.category:"Other",effects:s,preparation:typeof e.preparation=="string"?e.preparation:"",intensity:typeof e.intensity=="string"&&e.intensity.trim()?e.intensity:"Unknown",onset:typeof e.onset=="string"?e.onset:"",duration:typeof e.duration=="string"?e.duration:void 0,legalStatus:typeof e.legalStatus=="string"?e.legalStatus:"",region:typeof e.region=="string"?e.region:"",tags:t,normalizedCategories:Array.isArray(e.normalizedCategories)?e.normalizedCategories.filter(n=>typeof n=="string"):void 0,scientificName:typeof e.scientificName=="string"?e.scientificName:void 0,mechanismOfAction:typeof e.mechanismOfAction=="string"?e.mechanismOfAction:void 0,pharmacokinetics:typeof e.pharmacokinetics=="string"?e.pharmacokinetics:void 0,therapeuticUses:typeof e.therapeuticUses=="string"?e.therapeuticUses:void 0,sideEffects:typeof e.sideEffects=="string"?e.sideEffects:void 0,contraindications:typeof e.contraindications=="string"?e.contraindications:void 0,drugInteractions:typeof e.drugInteractions=="string"?e.drugInteractions:void 0,toxicity:typeof e.toxicity=="string"?e.toxicity:void 0,toxicityLD50:typeof e.toxicityLD50=="string"?e.toxicityLD50:void 0,description:typeof e.description=="string"?e.description:void 0,safetyRating:e.safetyRating!=null&&!isNaN(Number(e.safetyRating))?Number(e.safetyRating):void 0,sourceRefs:Array.isArray(e.sourceRefs)?e.sourceRefs.filter(n=>typeof n=="string"):void 0,image:typeof e.image=="string"?e.image:void 0,activeConstituents:Array.isArray(e.activeConstituents)?e.activeConstituents.filter(n=>n&&typeof n.name=="string"):void 0,affiliateLink:typeof e.affiliateLink=="string"?e.affiliateLink:""}}function Zt(){const[e,t]=E.useState([]),[s,r]=E.useState(!0);return E.useEffect(()=>{let n=!0;return fetch("/data/Full79.json").then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{if(!n)return;const o=(Array.isArray(a)?a:[]).map(je).filter(l=>l!==null);o.sort((l,u)=>l.name.localeCompare(u.name)),t(o)}).catch(a=>{console.error("Failed loading herbs",a);const i=We.map(je).filter(o=>o!==null);i.sort((o,l)=>o.name.localeCompare(l.name)),t(i)}).finally(()=>n&&r(!1)),()=>{n=!1}},[]),E.useEffect(()=>{},[]),{herbs:e,loading:s}}const qt=()=>c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-cosmic-forest",children:c.jsxs(w.div,{className:"flex flex-col items-center space-y-4",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:[c.jsxs("div",{className:"relative",children:[c.jsx(w.div,{className:"w-16 h-16 border-4 border-lichen rounded-full border-t-transparent",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),c.jsx(w.div,{className:"absolute inset-0 w-16 h-16 border-4 border-comet rounded-full border-b-transparent",animate:{rotate:-360},transition:{duration:1.5,repeat:1/0,ease:"linear"}})]}),c.jsx(w.p,{className:"text-white text-lg font-medium",animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0},children:"Loading..."})]})}),es=qt;function ts({query:e,setQuery:t,fuse:s}){const[r,n]=E.useState([]);E.useEffect(()=>{const o=e.trim();n(o?s.search(o,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[])},[e,s]);const a=o=>{if(!e)return o;const l=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=new RegExp(`(${l})`,"ig");return o.replace(u,'<span class="font-bold">$1</span>')},i=o=>{const l=[o.item.name,...o.item.altNames||[]].join(", ");return a(l)};return c.jsxs("div",{className:"relative w-full",children:[c.jsx("input",{type:"text",placeholder:"Search herbs...","aria-label":"Search herbs",tabIndex:0,value:e,onChange:o=>t(o.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),r.length>0&&c.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:r.map(o=>c.jsx("li",{children:c.jsx("button",{type:"button",tabIndex:0,"aria-label":`Select ${o.item.name}`,className:"w-full text-left rounded px-2 py-1 hover:bg-white/10",onClick:()=>t(o.item.name),dangerouslySetInnerHTML:{__html:i(o)}})},o.item.id))})]})}function ss(e,t){try{const s=localStorage.getItem(e);return s?JSON.parse(s):t}catch{return t}}function Ne(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function be(e){return{name:(e==null?void 0:e.name)||"Unnamed Herb",scientificName:(e==null?void 0:e.scientificName)||"",category:(e==null?void 0:e.category)||"Other",effects:Array.isArray(e==null?void 0:e.effects)?e.effects:[],preparation:(e==null?void 0:e.preparation)||"N/A",intensity:(e==null?void 0:e.intensity)||"Unknown",onset:(e==null?void 0:e.onset)||"Unknown",legalStatus:(e==null?void 0:e.legalStatus)||"Varies",region:(e==null?void 0:e.region)||"Unknown",tags:Array.isArray(e==null?void 0:e.tags)?e.tags:[],mechanismOfAction:(e==null?void 0:e.mechanismOfAction)||"Unclear",therapeuticUses:(e==null?void 0:e.therapeuticUses)||"",sideEffects:(e==null?void 0:e.sideEffects)||"",contraindications:(e==null?void 0:e.contraindications)||"",drugInteractions:(e==null?void 0:e.drugInteractions)||"",pharmacokinetics:(e==null?void 0:e.pharmacokinetics)||"",duration:(e==null?void 0:e.duration)||"",toxicity:(e==null?void 0:e.toxicity)||"",toxicityLD50:(e==null?void 0:e.toxicityLD50)||"",safetyRating:(e==null?void 0:e.safetyRating)??"Unknown"}}function ls(){const{herbs:e,loading:t}=Zt(),s=E.useMemo(()=>(e||[]).map(g=>{try{return Be(g),be(g)}catch(f){return console.warn("Failed cleaning herb",g==null?void 0:g.name,f),be({})}}),[e]),{favorites:r}=ke(),{filtered:n,query:a,setQuery:i,tags:o,setTags:l,matchAll:u,setMatchAll:d,categories:p,setCategories:y,favoritesOnly:A,setFavoritesOnly:m,fuse:C}=Jt(s,{favorites:r});E.useEffect(()=>{var N;const f=((N=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:N.split(","))||[];f.length&&setTimeout(()=>{f.forEach(k=>{const L=document.getElementById(`herb-${k}`);L&&(L.scrollIntoView({behavior:"smooth"}),L.classList.add("ring-2","ring-sky-300"),setTimeout(()=>L.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),E.useEffect(()=>{const g=ss("dbScroll",0);g&&window.scrollTo(0,g);const f=()=>Ne("dbScroll",window.scrollY);return window.addEventListener("scroll",f),()=>{Ne("dbScroll",window.scrollY),window.removeEventListener("scroll",f)}},[]);const b=E.useMemo(()=>{const g=s.reduce((f,N)=>f.concat(N.tags??[]),[]);return Array.from(new Set(g.map(B)))},[s]),j=E.useMemo(()=>{const g=s.filter(N=>N.affiliateLink&&N.affiliateLink.startsWith("http")).length,f=s.filter(N=>N.mechanismOfAction&&N.mechanismOfAction.trim()).length;return{total:s.length,affiliates:g,moaCount:f}},[s]);if(t)return c.jsxs("div",{className:"min-h-screen pt-20",children:[c.jsx(q,{}),c.jsx(es,{})]});if(!t&&s.length===0)return console.warn("No herbs available or failed to load."),c.jsxs("div",{className:"min-h-screen pt-20",children:[c.jsx(q,{}),c.jsx("p",{className:"text-center text-sand",children:"Failed to load herb database."})]});const F=E.useMemo(()=>{const g={};return s.forEach(f=>{(f.tags??[]).forEach(N=>{const k=B(N);g[k]=(g[k]||0)+1})}),g},[s]),[S,D]=E.useState(!1),[h,v]=E.useState(!0);E.useEffect(()=>{let g=window.scrollY;const f=()=>{const N=window.scrollY;v(N<g||N<100),g=N};return window.addEventListener("scroll",f),()=>window.removeEventListener("scroll",f)},[]),E.useEffect(()=>{const g=()=>{window.scrollY>150&&D(!1)};return window.addEventListener("scroll",g),window.addEventListener("touchmove",g),()=>{window.removeEventListener("scroll",g),window.removeEventListener("touchmove",g)}},[]);const M=E.useMemo(()=>{if(o.length===0)return[];const g={};return s.forEach(f=>{o.every(N=>(f.tags??[]).some(k=>B(k)===B(N)))&&(f.tags??[]).forEach(N=>{const k=B(N);o.some(L=>B(L)===k)||(g[k]=(g[k]||0)+1)})}),Object.entries(g).sort((f,N)=>N[1]-f[1]).slice(0,5).map(([f])=>f)},[o,s]);return c.jsxs(c.Fragment,{children:[c.jsxs(ze,{children:[c.jsx("title",{children:"Database - The Hippie Scientist"}),c.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),c.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[c.jsx(q,{}),c.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[c.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[c.jsx("h1",{className:"text-gradient mb-2 text-5xl font-bold",children:"Herb Database"}),c.jsxs("p",{className:"text-sand",children:["Total: ",s.length," Herbs Loaded"]}),c.jsx("p",{className:"mx-auto mt-2 max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),c.jsxs(w.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:h?0:-60,opacity:h?1:0},transition:{duration:.3},children:[c.jsx(ts,{query:a,setQuery:i,fuse:C}),c.jsx("button",{type:"button",onClick:()=>m(g=>!g),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:A?"All Herbs":"My Herbs"}),c.jsx("button",{type:"button",onClick:()=>d(g=>!g),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:u?"Match ALL":"Match ANY"}),c.jsx(se,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:c.jsx(Ke,{size:18})}),c.jsx("button",{type:"button",onClick:()=>D(g=>!g),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:S?"Hide Filters":"Show Filters"})]}),c.jsxs("div",{className:`mb-4 space-y-4 ${S?"":"hidden sm:block"}`,children:[c.jsx(Xt,{selected:p,onChange:y}),c.jsx(ct,{tags:b,counts:F,onChange:l})]}),M.length>0&&c.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[c.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),M.map(g=>c.jsx("button",{type:"button",onClick:()=>l(f=>Array.from(new Set([...f,g]))),className:"tag-pill",children:Q(g)},g))]}),c.jsx(lt,{}),c.jsx(ot,{herbs:n,highlightQuery:a}),c.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",j.total," Â· Affiliate links: ",j.affiliates," Â· MOA documented:"," ",j.moaCount," Â· Updated: ",new Date("2025-07-20T20:10:45.237Z").toLocaleDateString()]})]})]})]})}export{ls as default};
