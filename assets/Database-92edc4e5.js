import{l as D,r as k,j as e,m as M,A as U,R as c,o as _,W as $}from"./main-1c70c059.js";import{u as J,H as Q}from"./HerbList-e73ac6c1.js";import{T as q,c as V,I as W}from"./TagBadge-0db78c8b.js";import{c as T,n as H,a as K,d as R,t as X,b as ee}from"./format-b20dbf99.js";import{u as I}from"./useLocalStorage-228218fa.js";import{L as te,F as se}from"./leaf-ade264a6.js";import{G as ae}from"./globe-0566ef2c.js";import{u as B}from"./compoundData-ba7aaba1.js";import{F as ne}from"./fuse-11af6271.js";import{S as Y}from"./StarfieldBackground-524926d6.js";import"./slugify-386a61cd.js";import"./star-38be0712.js";/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=D("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=D("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.298.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=D("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),le={Effect:{label:"Effects",icon:re},Preparation:{label:"Preparation",icon:te},Safety:{label:"Safety",icon:oe},Chemistry:{label:"Chemistry",icon:se},Region:{label:"Region",icon:ae},Other:{label:"Other",icon:ie}},ce=["Effect","Preparation","Safety","Chemistry","Region","Other"];function de({tags:t,onChange:o,storageKey:m="tagFilters",counts:f={},mode:x="AND",onModeChange:y}){const[l,w]=I(m,[]),[a,p]=k.useState({Effect:!0,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1}),i=()=>w([]),[v,N]=k.useState({Effect:!1,Preparation:!1,Safety:!1,Chemistry:!1,Region:!1,Other:!1});k.useEffect(()=>{o==null||o(l)},[l,o]);const A=k.useMemo(()=>{const n={Effect:[],Preparation:[],Safety:[],Chemistry:[],Region:[],Other:[]};return t.forEach(u=>{const b=T(H(u)),j=K(b);n[j].includes(b)||n[j].push(b)}),n},[t]),C=n=>{const u=T(n);w(b=>b.includes(u)?b.filter(j=>j!==u):[...b,u])},L=n=>{const u=le[n],b=u.icon;return e.jsxs(e.Fragment,{children:[b&&e.jsx(b,{className:"mr-1 inline-block h-4 w-4"}),u.label]})},F=n=>{const u=A[n]||[],b=12,j=v[n]?u:u.slice(0,b);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"tag-list",children:[j.map(r=>e.jsx(M.button,{type:"button",onClick:()=>C(r),whileHover:{scale:1.1},whileTap:{scale:.95},animate:{opacity:l.includes(r)?1:.6},"aria-pressed":l.includes(r),className:"flex-shrink-0 focus:outline-none",title:f[r]?`${R(H(r))} — used in ${f[r]} herbs`:R(H(r)),children:e.jsx(q,{label:R(H(r)),variant:l.includes(r)?"green":X(r),className:V(l.includes(r)&&"ring-1 ring-emerald-400")})},r)),u.length>b&&e.jsx(M.button,{type:"button",whileHover:{scale:1.05},onClick:()=>N(r=>({...r,[n]:!r[n]})),className:"tag-pill mt-2",children:v[n]?"Show Less":"Show More"})]})})};return e.jsxs("div",{className:"sticky top-16 z-20 space-y-3 sm:static",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y==null?void 0:y(x==="AND"?"OR":"AND"),className:"tag-pill",children:x==="AND"?"Match ALL":"Match ANY"}),l.length>0&&e.jsx("button",{type:"button",onClick:i,className:"tag-pill animate-pulse ring-2 ring-psychedelic-pink",children:"Reset Filters"})]}),ce.map(n=>e.jsxs("div",{className:"tag-section",children:[e.jsxs("button",{type:"button",className:"tag-label",onClick:()=>p(u=>({...u,[n]:!u[n]})),"aria-expanded":a[n],children:[L(n),e.jsx(M.span,{animate:{rotate:a[n]?90:0},className:"ml-1 text-xs",children:"▶"})]}),e.jsx(U,{initial:!1,children:a[n]&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:F(n)},"content")})]},n))]})}function me(){const t=B(),o=k.useMemo(()=>{const i={};return t==null||t.forEach(v=>{const N=v.category.split("/")[0].trim();i[N]=(i[N]||0)+1}),i},[t]),m=k.useMemo(()=>Object.entries(o).sort((i,v)=>v[1]-i[1]),[o]),[f,x]=k.useState(!1),[y,l]=k.useState(""),w=k.useMemo(()=>m.filter(([i])=>i.toLowerCase().includes(y.toLowerCase())),[m,y]),a=f?w:w.slice(0,12),p=Math.max(...m.map(([,i])=>i));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Find category",value:y,onChange:i=>l(i.target.value),className:"w-36 flex-1 rounded-md bg-space-dark/50 px-2 py-1 text-sm backdrop-blur-md"}),e.jsx("button",{type:"button",onClick:()=>x(i=>!i),className:"tag-pill",children:f?"Collapse":"Show All"})]}),e.jsx("div",{className:"space-y-2",children:a.map(([i,v])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{text:`${v} herbs`,children:e.jsx("span",{className:"w-40 truncate text-sm",children:i})}),e.jsx("div",{className:"h-2 flex-1 rounded bg-slate-700/50",children:e.jsx("div",{className:"h-2 rounded bg-fuchsia-500",style:{width:`${v/p*100}%`}})})]},i))})]})}function ue(t){const o=t.match(/\(([^)]+)\)/);return o?o[1].split(/[,/]| or /).map(m=>m.trim()).filter(Boolean):[]}const z={ayahuasca:["chacruna","banisteriopsis caapi","psychotria viridis"]};function Z(t){const o=t.toLowerCase();return/(empathogen|euphoriant)/.test(o)?"Empathogen":/(psychedelic|visionary)/.test(o)?"Psychedelic":/dissociative|sedative/.test(o)?"Dissociative":/oneirogen|dream/.test(o)?"Oneirogen":"Other"}function pe(t,o={}){const{favorites:m=[]}=o,f=t??[],[x,y]=c.useState(""),[l,w]=c.useState([]),[a,p]=c.useState("AND"),[i,v]=c.useState(!1),[N,A]=I("dbCategories",[]),[C,L]=c.useState(""),F=c.useMemo(()=>f.map(r=>({...r,aliases:[...ue(r.name),...z[r.id]||z[r.name.toLowerCase()]||[]],tagAliases:r.tags.map(E=>ee(T(E))).filter(Boolean)})),[f]),n=c.useMemo(()=>new ne(F,{keys:["name","aliases","scientificName","activeConstituents.name","effects","description","tags","tagAliases"],threshold:.4,includeMatches:!0,isCaseSensitive:!1,ignoreLocation:!0}),[F]),[u,b]=c.useState({});return{filtered:c.useMemo(()=>{let r=[];const E=x.trim();E?r=n.search(E):r=f.map(g=>({item:g}));const O={};r.forEach(g=>{g.matches&&(O[g.item.id]=g.matches)}),b(O);let S=r.map(g=>g.item);return l.length&&(S=S.filter(g=>{const s=l.map(d=>g.tags.some(h=>T(h)===T(d)));return a==="AND"?s.every(Boolean):s.some(Boolean)})),N.length&&(S=S.filter(g=>N.includes(Z(g.category)))),i&&(S=S.filter(g=>m.includes(g.id))),C==="name"&&(S=[...S].sort((g,s)=>g.name.localeCompare(s.name))),S},[f,x,l,N,i,m,C,n]),matches:u,query:x,setQuery:y,tags:l,setTags:w,tagMode:a,setTagMode:p,categories:N,setCategories:A,favoritesOnly:i,setFavoritesOnly:v,sort:C,setSort:L,fuse:n}}function he({selected:t,onChange:o}){const m=B(),[f,x]=k.useState(!1),y=c.useMemo(()=>{const a={};return m==null||m.forEach(p=>{const i=Z(p.category);a[i]=(a[i]||0)+1}),a},[m]),l=a=>{const p=t.includes(a)?t.filter(i=>i!==a):[...t,a];o==null||o(p)},w=e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(y).sort((a,p)=>p[1]-a[1]).map(([a,p])=>e.jsxs("button",{type:"button",onClick:()=>l(a),className:`tag-pill max-w-[7rem] truncate ${t.includes(a)?"ring-2 ring-emerald-400":""}`,children:[a," (",p,")"]},a))});return e.jsxs("div",{children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>x(a=>!a),className:"tag-pill mb-2",children:f?"Hide Categories":"Show Categories"}),e.jsx(U,{initial:!1,children:f&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:w},"cats")})]}),e.jsx("div",{className:"hidden sm:block",children:w})]})}function fe({query:t,setQuery:o,fuse:m}){const[f,x]=c.useState([]),[y,l]=c.useState(!1);c.useEffect(()=>{l(!0);const a=t.trim(),p=setTimeout(()=>{x(a?m.search(a,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[]),l(!1)},200);return()=>clearTimeout(p)},[t,m]);const w=a=>{if(!t)return a;const p=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${p})`,"ig");return a.replace(i,'<mark class="rounded bg-yellow-500/40 px-1">$1</mark>')};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...",value:t,onChange:a=>o(a.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),y&&e.jsx("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-black/80 p-2 text-center text-sm text-sand backdrop-blur-md",children:"Searching..."}),!y&&f.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:f.map(a=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full rounded px-2 py-1 text-left hover:bg-white/10",onClick:()=>o(a.item.name),dangerouslySetInnerHTML:{__html:w(a.item.name)}})},a.item.id))})]})}function ge(t,o){try{const m=localStorage.getItem(t);return m?JSON.parse(m):o}catch{return o}}function G(t,o){try{localStorage.setItem(t,JSON.stringify(o))}catch{}}function Te(){const t=B();console.log("herbs length",t?t.length:"loading");const{favorites:o}=J(),{filtered:m,matches:f,query:x,setQuery:y,tags:l,setTags:w,categories:a,setCategories:p,tagMode:i,setTagMode:v,favoritesOnly:N,setFavoritesOnly:A,fuse:C}=pe(t,{favorites:o}),[L,F]=I("dbCompact",!1),[n,u]=_();if(!t||t.length===0)return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx("title",{children:"Database - The Hippie Scientist"})}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(Y,{}),e.jsx("div",{className:"text-center text-sand",children:"Unable to load herb data."})]})]});c.useEffect(()=>{const s=ge("dbScroll",0);s&&window.scrollTo(0,s);const d=()=>G("dbScroll",window.scrollY);return window.addEventListener("scroll",d),()=>{G("dbScroll",window.scrollY),window.removeEventListener("scroll",d)}},[]),c.useEffect(()=>{const s=localStorage.getItem("focusHerb");if(s){const d=document.getElementById(s);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),localStorage.removeItem("focusHerb")}},[]);const b=c.useMemo(()=>{if(!t)return[];const s=t.reduce((d,h)=>d.concat(h.tags),[]);return Array.from(new Set(s.map(T)))},[t]),j=c.useMemo(()=>{const s={};return t==null||t.forEach(d=>{d.tags.forEach(h=>{const P=T(h);s[P]=(s[P]||0)+1})}),s},[t]);c.useEffect(()=>{Object.keys(j).length&&console.log("Tag usage counts",j)},[j]);const[r,E]=c.useState(!1),[O,S]=c.useState(!0);c.useEffect(()=>{const s=n.get("tags");if(s){const d=s.split(",").map(h=>decodeURIComponent(h));w(d)}},[]),c.useEffect(()=>{l.length>0?n.set("tags",l.map(encodeURIComponent).join(",")):n.delete("tags"),u(n,{replace:!0})},[l,n,u]),c.useEffect(()=>{let s=window.scrollY;const d=()=>{const h=window.scrollY;S(h<s||h<100),s=h};return window.addEventListener("scroll",d),()=>window.removeEventListener("scroll",d)},[]),c.useEffect(()=>{const s=()=>{window.scrollY>150&&E(!1)};return window.addEventListener("scroll",s),window.addEventListener("touchmove",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("touchmove",s)}},[]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[l,a,x]);const g=c.useMemo(()=>{if(l.length===0)return[];const s={};return t==null||t.forEach(d=>{l.every(h=>d.tags.includes(h))&&d.tags.forEach(h=>{l.includes(h)||(s[h]=(s[h]||0)+1)})}),Object.entries(s).sort((d,h)=>h[1]-d[1]).slice(0,5).map(([d])=>d)},[l,t]);return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(Y,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(M.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:O?0:-60,opacity:O?1:0},transition:{duration:.3},children:[e.jsx(fe,{query:x,setQuery:y,fuse:C}),e.jsx("button",{type:"button",onClick:()=>A(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:N?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>F(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:L?"Full Cards":"Compact"}),e.jsx("button",{type:"button",onClick:()=>E(s=>!s),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:r?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${r?"":"hidden sm:block"}`,children:[e.jsx(he,{selected:a,onChange:p}),e.jsx(de,{tags:b,counts:j,onChange:w,mode:i,onModeChange:v})]}),g.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),g.map(s=>e.jsx("button",{type:"button",onClick:()=>w(d=>Array.from(new Set([...d,s]))),className:"tag-pill",children:R(s)},s))]}),e.jsx(me,{}),e.jsx(Q,{herbs:m,highlightQuery:x,matches:f,compact:L,pageSize:30})]})]})]})}export{Te as default};
