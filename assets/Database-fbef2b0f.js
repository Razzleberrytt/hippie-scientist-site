import{j as e,m as f,e as E,R as c,h as L,p as I,q as b,W as D,L as R,D as Y}from"./main-8407c2c0.js";import{H as z}from"./HerbList-838334ce.js";import{m as U,u as _}from"./useFilteredHerbs-640afa8f.js";import{S as J}from"./StarfieldBackground-c8c6efe8.js";import{u as P}from"./useHerbs-203056aa.js";function W({allTags:a,activeTags:o,onToggleTag:d}){const u=r=>{d(r)},l=()=>{o.forEach(r=>d(r))};return e.jsxs("div",{className:"no-scrollbar flex gap-2 overflow-x-auto py-2",children:[a.map(r=>{const m=o.includes(r);return e.jsx(f.button,{type:"button",onClick:()=>u(r),whileTap:{scale:.9},whileHover:{scale:1.08},animate:m?{scale:[1,1.15,1],boxShadow:"0 0 8px rgba(16,185,129,0.8)"}:{scale:1,boxShadow:"none"},transition:{type:"spring",stiffness:220,damping:12},className:`tag-pill hover-glow whitespace-nowrap transition-colors duration-300 ${m?"bg-emerald-700/70 text-white ring-2 ring-emerald-400 dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:E(r)},r)}),o.length>0&&e.jsx(f.button,{type:"button",onClick:l,whileTap:{scale:.9},whileHover:{scale:1.08},transition:{type:"spring",stiffness:220,damping:12},className:"tag-pill hover-glow whitespace-nowrap bg-rose-700/70 text-white dark:bg-rose-800 transition-colors duration-300",children:"Clear Filters"})]})}const N=5;function Z(){const a=c.useMemo(()=>{const s={};return L.forEach(h=>{const p=h.category.split("/")[0].trim();s[p]=(s[p]||0)+1}),s},[]),o=c.useMemo(()=>Object.entries(a).sort((s,h)=>h[1]-s[1]),[a]),[d,u]=c.useState(!1),l=c.useMemo(()=>d?o:o.filter(([,s])=>s>=N),[o,d]),r=c.useMemo(()=>o.some(([,s])=>s<N),[o]),m=Math.max(...o.map(([,s])=>s));return e.jsxs("div",{className:"relative space-y-2",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[l.map(([s,h])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-40 text-sm",children:s}),e.jsx("div",{className:"flex-1 h-2 rounded bg-gray-200 dark:bg-gray-700 transition-colors duration-300",children:e.jsx("div",{className:"h-2 rounded bg-pink-500 dark:bg-pink-400 transition-colors duration-300",style:{width:`${h/m*100}%`}})}),e.jsx("span",{className:"text-sm",children:h})]},s)),r&&!d&&e.jsx("div",{className:"pointer-events-none text-center text-xs text-moss",children:"Hover to show more"})]})}function Q({selected:a,onChange:o}){const d=c.useMemo(()=>{const l={};return L.forEach(r=>{const m=U(r.category);l[m]=(l[m]||0)+1}),l},[]),u=l=>{const r=a.includes(l)?a.filter(m=>m!==l):[...a,l];o==null||o(r)};return e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d).sort((l,r)=>r[1]-l[1]).map(([l,r])=>e.jsxs("button",{type:"button",onClick:()=>u(l),className:`tag-pill transition-colors duration-300 ${a.includes(l)?"ring-2 ring-emerald-400 bg-emerald-700/70 text-white dark:bg-emerald-800":"bg-space-dark/70 text-sand dark:bg-gray-800 dark:text-gray-200"}`,children:[l," (",r,")"]},l))})}function G({query:a,setQuery:o,fuse:d}){const[u,l]=c.useState([]);c.useEffect(()=>{const s=a.trim();l(s?d.search(s,{limit:5,isCaseSensitive:!1,ignoreLocation:!0}):[])},[a,d]);const r=s=>{if(!a)return s;const h=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`(${h})`,"ig");return s.replace(p,'<span class="font-bold">$1</span>')},m=s=>{const h=[s.item.name,...s.item.altNames||[]].join(", ");return r(h)};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"Search herbs...","aria-label":"Search herbs",tabIndex:0,value:a,onChange:s=>o(s.target.value),className:"w-full rounded-md bg-space-dark/70 px-3 py-2 text-white backdrop-blur-md focus:outline-none"}),u.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-black/80 p-2 text-sm text-sand backdrop-blur-md",children:u.map(s=>e.jsx("li",{children:e.jsx("button",{type:"button",tabIndex:0,"aria-label":`Select ${s.item.name}`,className:"w-full text-left rounded px-2 py-1 hover:bg-white/10",onClick:()=>o(s.item.name),dangerouslySetInnerHTML:{__html:m(s)}})},s.item.id))})]})}function K(a,o){try{const d=localStorage.getItem(a);return d?JSON.parse(d):o}catch{return o}}function S(a,o){try{localStorage.setItem(a,JSON.stringify(o))}catch{}}function se(){const a=P(),{favorites:o}=I(),{filtered:d,query:u,setQuery:l,tags:r,setTags:m,matchAll:s,setMatchAll:h,categories:p,setCategories:C,favoritesOnly:M,setFavoritesOnly:T,sort:A,setSort:F,fuse:H}=_(a,{favorites:o});c.useEffect(()=>{var i;const n=((i=new URLSearchParams(window.location.search).get("herbs"))==null?void 0:i.split(","))||[];n.length&&setTimeout(()=>{n.forEach(x=>{const g=document.getElementById(`herb-${x}`);g&&(g.scrollIntoView({behavior:"smooth"}),g.classList.add("ring-2","ring-sky-300"),setTimeout(()=>g.classList.remove("ring-2","ring-sky-300"),2e3))})},300)},[]),c.useEffect(()=>{const t=K("dbScroll",0);t&&window.scrollTo(0,t);const n=()=>S("dbScroll",window.scrollY);return window.addEventListener("scroll",n),()=>{S("dbScroll",window.scrollY),window.removeEventListener("scroll",n)}},[]);const O=c.useMemo(()=>{const t=a.reduce((n,i)=>n.concat(i.tags),[]);return Array.from(new Set(t.map(b)))},[a]),w=c.useMemo(()=>{const t=a.filter(i=>i.affiliateLink&&i.affiliateLink.startsWith("http")).length,n=a.filter(i=>i.mechanismOfAction&&i.mechanismOfAction.trim()).length;return{total:a.length,affiliates:t,moaCount:n}},[a]),$=c.useCallback(t=>m(n=>n.includes(t)?n.filter(i=>i!==t):[...n,t]),[m]),[v,y]=c.useState(!1),[j,B]=c.useState(!0);c.useEffect(()=>{let t=window.scrollY;const n=()=>{const i=window.scrollY;B(i<t||i<100),t=i};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[]),c.useEffect(()=>{const t=()=>{window.scrollY>150&&y(!1)};return window.addEventListener("scroll",t),window.addEventListener("touchmove",t),()=>{window.removeEventListener("scroll",t),window.removeEventListener("touchmove",t)}},[]);const k=c.useMemo(()=>{if(r.length===0)return[];const t={};return a.forEach(n=>{r.every(i=>n.tags.some(x=>b(x)===b(i)))&&n.tags.forEach(i=>{const x=b(i);r.some(g=>b(g)===x)||(t[x]=(t[x]||0)+1)})}),Object.entries(t).sort((n,i)=>i[1]-n[1]).slice(0,5).map(([n])=>n)},[r,a]);return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:"Database - The Hippie Scientist"}),e.jsx("meta",{name:"description",content:"Browse herbal entries and expand each to learn more about their effects and usage."})]}),e.jsxs("div",{className:"relative min-h-screen px-4 pt-20",children:[e.jsx(J,{}),e.jsxs("div",{className:"relative mx-auto max-w-6xl",children:[e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-gradient mb-6 text-5xl font-bold",children:"Herb Database"}),e.jsx("p",{className:"mx-auto max-w-4xl text-xl text-sand",children:"Explore our collection of herbs. Click any entry to see detailed information."})]}),e.jsxs(f.div,{className:"sticky top-2 z-20 mb-4 flex flex-wrap items-center gap-2",animate:{y:j?0:-60,opacity:j?1:0},transition:{duration:.3},children:[e.jsx(G,{query:u,setQuery:l,fuse:H}),e.jsx("button",{type:"button",onClick:()=>T(t=>!t),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-yellow-300 backdrop-blur-md hover:bg-white/10",children:M?"All Herbs":"My Herbs"}),e.jsx("button",{type:"button",onClick:()=>h(t=>!t),className:"hover-glow rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:s?"Match ALL":"Match ANY"}),e.jsxs("select",{value:A,onChange:t=>F(t.target.value),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10",children:[e.jsx("option",{value:"",children:"Sort By..."}),e.jsx("option",{value:"name",children:"Alphabetical (A–Z)"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"intensity",children:"Psychoactive Intensity"}),e.jsx("option",{value:"blend",children:"Blend-Friendliness"})]}),e.jsx(R,{to:"/downloads",className:"rounded-md bg-space-dark/70 p-2 text-sand backdrop-blur-md hover:bg-white/10","aria-label":"Export data",children:e.jsx(Y,{size:18})}),e.jsx("button",{type:"button",onClick:()=>y(t=>!t),className:"rounded-md bg-space-dark/70 px-3 py-2 text-sm text-sand backdrop-blur-md hover:bg-white/10 sm:hidden",children:v?"Hide Filters":"Show Filters"})]}),e.jsxs("div",{className:`mb-4 space-y-4 ${v?"":"hidden sm:block"}`,children:[e.jsx(Q,{selected:p,onChange:C}),e.jsx(W,{allTags:O,activeTags:r,onToggleTag:$})]}),k.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-moss",children:"Related tags:"}),k.map(t=>e.jsx("button",{type:"button",onClick:()=>m(n=>Array.from(new Set([...n,t]))),className:"tag-pill",children:E(t)},t))]}),e.jsx(Z,{}),e.jsx(z,{herbs:d,highlightQuery:u}),e.jsxs("footer",{className:"mt-4 text-center text-sm text-moss",children:["Total herbs: ",w.total," · Affiliate links: ",w.affiliates," · MOA documented:"," ",w.moaCount," · Updated: ",new Date("2025-07-23T02:30:06.459Z").toLocaleDateString()]})]})]})]})}export{se as default};
